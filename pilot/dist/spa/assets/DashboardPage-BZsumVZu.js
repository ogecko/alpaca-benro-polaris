import{a0 as H,av as O,d as V,a as x,c as m,q as j,D as G,E as g,F as i,H as u,I as n,J as y,Q as z,N as p,s as _,M as f,P as J,O as I,L as W,T as X,S as Y}from"./index-D0PfnkpG.js";import{Q as Z}from"./QBtnGroup-BfIGs6_K.js";import{Q as A}from"./QItemLabel-DtikKCSR.js";import{Q as P,a as C}from"./QItem-DWSf3WsE.js";import{Q as ee}from"./QList-Dg1_BxG8.js";import{Q as ae}from"./QBtnDropdown-C0BUcS7H.js";import{Q as te}from"./QSpace-BN0aJBPV.js";import{Q as oe}from"./QChip-C2ElM3rU.js";import{Q as le}from"./QPage-DDnpSOm6.js";import{j as ne,k as se}from"./position-engine-DcXdba3W.js";import{u as ie}from"./use-quasar-BJ_974Js.js";import{u as re}from"./device-BmVq6k0z.js";import{u as ce}from"./status-BAlaugUt.js";import{a as T,S as pe}from"./SpinnerSpeed-BQhU-bhX.js";import{_ as de}from"./StatusBanners.vue_vue_type_script_setup_true_lang-BRv7l7Yp.js";import"./use-dark-8KyFGCrv.js";import"./QMenu-CIx404Kj.js";import"./use-model-toggle-R2LY4fXv.js";import"./use-tick-BSz4V3MX.js";import"./use-timeout-el27kvYe.js";import"./focus-manager-BJWzFvJg.js";import"./use-key-composition-Di3_QzSz.js";import"./selection-B4v7s9oW.js";import"./QInput-BmPm8Cyr.js";import"./index-DaEgsOZv.js";import"./angles-DsQ2VyPl.js";import"./scale-mzrGa2OM.js";import"./MoveButton.vue_vue_type_script_setup_true_lang-Ci4vo5VO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QBanner-Dj-BV9YE.js";function M(s){if(s===!1)return 0;if(s===!0||s===void 0)return 1;const r=parseInt(s,10);return isNaN(r)?0:r}const S=H({name:"close-popup",beforeMount(s,{value:r}){const c={depth:M(r),handler(o){c.depth!==0&&setTimeout(()=>{const a=ne(s);a!==void 0&&se(a,o,c.depth)})},handlerKey(o){O(o,13)===!0&&c.handler(o)}};s.__qclosepopup=c,s.addEventListener("click",c.handler),s.addEventListener("keyup",c.handlerKey)},updated(s,{value:r,oldValue:c}){r!==c&&(s.__qclosepopup.depth=M(r))},beforeUnmount(s){const r=s.__qclosepopup;s.removeEventListener("click",r.handler),s.removeEventListener("keyup",r.handlerKey),delete s.__qclosepopup}}),ue={class:"row q-pa-xs items-center q-col-gutter-sm"},me={class:"q-pb-sm"},ge={class:"q-gutter-md"},fe={class:"row"},ve={key:0,class:"col-12 col-md-6 col-lg-4 col-xl-3 row justify-center"},je=V({__name:"DashboardPage",setup(s){const r=ie(),c=G(),o=re(),a=ce(),v=x(!1),$=x(!0),R=m(()=>v.value?[{label:"Right Ascension",pv:a.rightascension,sp:a.deltarefRAhrs,domain:"ra_24"},{label:"Declination",pv:a.declination,sp:a.deltaref[1],domain:"dec_180"},{label:"Position Angle",pv:a.positionangle,sp:a.deltaref[2],domain:"pa_360"}]:[{label:"Azimuth",pv:a.azimuth,sp:a.alpharef[0],domain:"az_360"},{label:"Altitude",pv:a.altitude,sp:a.alpharef[1],domain:"alt_90"},{label:"Roll",pv:a.roll,sp:a.alpharef[2],domain:"roll_180"}]),k=m(()=>(r.screen.lt.sm,"md")),b=m(()=>!!r.screen.lt.md),Q=m(()=>a.pidmode=="PRESETUP"?"PreSetup":a.pidmode=="LIMIT"?"Limit":a.atpark?"Parked":a.gotoing?"Gotoing":a.slewing?"Slewing":a.rotating?"Rotating":a.ispulseguiding?"Guiding":a.tracking?"Tracking":"Idle"),L=m(()=>a.pidmode=="PRESETUP"||a.pidmode=="LIMIT"?"negative":"positive"),D=m(()=>a.pidmode=="PRESETUP"?"mdi-cellphone-cog":a.pidmode=="LIMIT"?"mdi-alert":a.atpark?"mdi-parking":a.gotoing?"mdi-move-resize-variant":a.slewing?"mdi-cursor-move":a.rotating?"mdi-restore":a.ispulseguiding?"mdi-pulse":a.tracking?"mdi-star-shooting-outline":"mdi-sleep");j(async()=>{const e=Array.isArray(c.query.api)?c.query.api[0]:c.query.api;e&&(o.restAPIPort=parseInt(e)),!o.alpacaHost&&window.location.hostname&&(o.alpacaHost=window.location.hostname),!o.restAPIPort&&window.location.port&&(o.restAPIPort=parseInt(window.location.port)),o.alpacaHost&&o.restAPIPort&&await o.connectRestAPI()});function w(e){return a.atpark?(r.notify({message:`Cannot ${e} while mount is parked.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):!1}async function E(){if(w("toggle tracking"))return;const e=a.tracking?await o.alpacaTracking(!1):await o.alpacaTracking(!0);console.log(e)}async function h(e){const t=await o.alpacaTrackingRate(e);console.log(t)}async function B(){const e=a.atpark?await o.alpacaUnPark():await o.alpacaPark();console.log(e)}async function N(){if(w("abort"))return;$.value=!1,setTimeout(()=>{$.value=!0},200);const e=await o.alpacaAbortSlew();console.log(e)}async function K(e){if(!w("slew"))if(e.label=="Azimuth"){const t=e.angle,l=a.alpharef[1]??0,d=await o.alpacaSlewToAltAz(l,t);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Altitude"){const t=a.alpharef[0]??0,l=e.angle,d=await o.alpacaSlewToAltAz(l,t);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Roll"){const t=await o.alpacaMoveMechanical(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,t)}else if(e.label=="Right Ascension"){const t=e.angle,l=a.deltaref[1]??0,d=await o.alpacaSlewToCoord(t,l);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Declination"){const t=a.deltarefRAhrs??0,l=e.angle,d=await o.alpacaSlewToCoord(t,l);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Position Angle"){const t=await o.alpacaMoveAbsolute(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,t)}else console.log(`Click ${e.label} angle: ${e.angle}, offset: ${e.radialOffset}`)}async function U(e){if(w("slew"))return;const t=e.az??a.alpharef[0]??0,l=e.alt??a.alpharef[1]??0;e.roll!==void 0&&await o.alpacaMoveMechanical(e.roll),(e.az!==void 0||e.alt!==void 0)&&await o.alpacaSlewToAltAz(l,t),console.log("Fab Angle:",e)}const q={Azimuth:0,Altitude:1,Roll:2,"Right Ascension":3,Declination:4,"Position Angle":5};async function F(e){if(console.log("ClickMove ",e.label,e.rateScale),!Object.keys(q).includes(e.label))return;const t=q[e.label]??-1,l=t!=3?e.rateScale/200*9:e.rateScale/12*9;t>=0&&t<=5&&await o.apiAction("Polaris:MoveAxis",`{"axis":${t},"rate":${l}}`)}return(e,t)=>(u(),g(le,{class:"q-pa-sm"},{default:i(()=>[n(de),y("div",ue,[y("div",me,[y("div",ge,[n(Z,null,{default:i(()=>[n(z,{icon:"mdi-telescope",glossy:"",dense:b.value,size:k.value,color:"secondary",push:"",outline:!v.value,onClick:t[0]||(t[0]=l=>v.value=!v.value)},null,8,["dense","size","outline"]),n(z,{icon:"mdi-parking",glossy:"",dense:b.value,size:k.value,color:"secondary",outline:!p(a).atpark,onClick:B},null,8,["dense","size","outline"]),n(z,{icon:"mdi-stop",glossy:"",dense:b.value,size:k.value,color:"secondary",outline:$.value,onClick:N},null,8,["dense","size","outline"])]),_:1}),n(ae,{dense:b.value,icon:"mdi-star-shooting-outline",glossy:"",size:k.value,color:"secondary",split:"",outline:!p(a).tracking,onClick:E},{default:i(()=>[n(ee,{dense:""},{default:i(()=>[_((u(),g(P,{clickable:"",active:p(a).trackingrate==0,"active-class":"bg-secondary text-white",onClick:t[1]||(t[1]=l=>h(0))},{default:i(()=>[n(C,null,{default:i(()=>[n(A,null,{default:i(()=>t[5]||(t[5]=[f("Sidereal",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["active"])),[[S]]),_((u(),g(P,{clickable:"",active:p(a).trackingrate==1,"active-class":"bg-secondary text-white",onClick:t[2]||(t[2]=l=>h(1))},{default:i(()=>[n(C,null,{default:i(()=>[n(A,null,{default:i(()=>t[6]||(t[6]=[f("Lunar",-1)])),_:1,__:[6]})]),_:1})]),_:1},8,["active"])),[[S]]),_((u(),g(P,{clickable:"",active:p(a).trackingrate==2,"active-class":"bg-secondary text-white",onClick:t[3]||(t[3]=l=>h(2))},{default:i(()=>[n(C,null,{default:i(()=>[n(A,null,{default:i(()=>t[7]||(t[7]=[f("Solar",-1)])),_:1,__:[7]})]),_:1})]),_:1},8,["active"])),[[S]]),_((u(),g(P,{clickable:"",active:p(a).trackingrate==3,"active-class":"bg-secondary text-white",onClick:t[4]||(t[4]=l=>h(3))},{default:i(()=>[n(C,null,{default:i(()=>[n(A,null,{default:i(()=>t[8]||(t[8]=[f("Custom",-1)])),_:1,__:[8]})]),_:1})]),_:1},8,["active"])),[[S]])]),_:1})]),_:1},8,["dense","size","outline"])])]),n(te),n(oe,{color:L.value,outline:Q.value=="Idle",icon:D.value,class:"q-pa-md"},{default:i(()=>[f(J(Q.value),1)]),_:1},8,["color","outline","icon"])]),y("div",fe,[(u(!0),I(Y,null,X(R.value,(l,d)=>(u(),I("div",{key:d,class:"col-12 col-md-6 col-lg-4 col-xl-3"},[n(pe,{label:l.label,pv:l.pv,sp:l.sp,lst:p(a).siderealtime,domain:l.domain,onClickScale:K,onClickFabAngle:U,onClickMove:F},null,8,["label","pv","sp","lst","domain"])]))),128)),p(a).pidmode!="PARK"?(u(),I("div",ve,[n(T,{class:"q-pa-sm",speed:p(a).motorref[0],label:"M1"},null,8,["speed"]),n(T,{class:"q-pa-sm",speed:p(a).motorref[1],label:"M2"},null,8,["speed"]),n(T,{class:"q-pa-sm",speed:p(a).motorref[2],label:"M3"},null,8,["speed"])])):W("",!0)])]),_:1}))}});export{je as default};
