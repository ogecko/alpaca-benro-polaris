import{a1 as W,aw as X,d as Y,a as M,c as m,q as Z,D as ee,E as f,F as i,H as p,I as n,J as _,K as E,Q as A,M as u,s as P,N as b,P as ae,O as I,T as te,S as oe}from"./index-CzUz1poz.js";import{Q as le}from"./QBtnGroup-CyVg6k59.js";import{Q as C}from"./QItemLabel-4d6Diaq8.js";import{Q as S,a as z}from"./QItem-CIxyHNF2.js";import{Q as ne}from"./QList-D1nyExqs.js";import{Q as se}from"./QBtnDropdown-Bd8j8KW6.js";import{Q as ie}from"./QSpace-WNZS6s5s.js";import{Q as re}from"./QChip-Bahj5nA8.js";import{Q as ce}from"./QPage-2ewRn8KR.js";import{j as de,k as ue}from"./position-engine-kA1ZDrPo.js";import{u as pe}from"./use-quasar-vHExpJql.js";import{u as me}from"./device-BWnNoMeK.js";import{u as fe}from"./status-DQXUPgEb.js";import{a as R,S as ge}from"./SpinnerSpeed-SMiVDP28.js";import{_ as ve}from"./StatusBanners.vue_vue_type_script_setup_true_lang-CCCdilvw.js";import{c as g}from"./angles-BzRmwPyf.js";import"./use-dark-CN-7xWWN.js";import"./QMenu-CITyKRcB.js";import"./use-model-toggle-Cl3EjlHt.js";import"./use-tick-DJycfyCh.js";import"./use-timeout-DK6K2111.js";import"./focus-manager-BJWzFvJg.js";import"./use-key-composition-C77PqFJU.js";import"./selection-BBj0YpLT.js";import"./QInput-BuwOO0Om.js";import"./index-DaEgsOZv.js";import"./scale-WFj20Uim.js";import"./MoveButton.vue_vue_type_script_setup_true_lang-CPb_bgPh.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QBanner-gQDwPbxk.js";function L(s){if(s===!1)return 0;if(s===!0||s===void 0)return 1;const r=parseInt(s,10);return isNaN(r)?0:r}const $=W({name:"close-popup",beforeMount(s,{value:r}){const c={depth:L(r),handler(o){c.depth!==0&&setTimeout(()=>{const e=de(s);e!==void 0&&ue(e,o,c.depth)})},handlerKey(o){X(o,13)===!0&&c.handler(o)}};s.__qclosepopup=c,s.addEventListener("click",c.handler),s.addEventListener("keyup",c.handlerKey)},updated(s,{value:r,oldValue:c}){r!==c&&(s.__qclosepopup.depth=L(r))},beforeUnmount(s){const r=s.__qclosepopup;s.removeEventListener("click",r.handler),s.removeEventListener("keyup",r.handlerKey),delete s.__qclosepopup}}),ke={class:"row q-pa-xs items-center q-col-gutter-sm"},be={class:"q-pb-sm"},he={class:"q-gutter-md"},we={class:"row"},ye={key:0,class:"col-12 col-md-6 col-lg-4 col-xl-3 row justify-center"},Ze=Y({__name:"DashboardPage",setup(s){const r=pe(),c=ee(),o=me(),e=fe(),h=M(!1),D=M(!0),B=m(()=>h.value?[{label:"Right Ascension",pv:e.rightascension,sp:e.deltarefRAhrs,domain:"ra_24"},{label:"Declination",pv:e.declination,sp:e.deltaref[1],domain:"dec_180"},{label:"Position Angle",pv:e.positionangle,sp:e.deltaref[2],domain:"pa_360"}]:[{label:"Azimuth",pv:e.azimuth,sp:e.alpharef[0],domain:"az_360"},{label:"Altitude",pv:e.altitude,sp:e.alpharef[1],domain:"alt_90"},{label:"Roll",pv:e.roll,sp:e.alpharef[2],domain:"roll_180"}]),N=m(()=>{if(e.pidmode!="IDLE")return!1;const a=g(e.rightascension,e.deltarefRAhrs),t=g(e.declination,e.deltaref[1]??0),l=g(e.positionangle,e.deltaref[2]??0),d=g(e.azimuth,e.alpharef[0]??0),q=g(e.altitude,e.alpharef[1]??0),x=g(e.roll,e.alpharef[2]??0);return a*a+t*t+l*l+d*d+q*q+x*x>1}),v=m(()=>(r.screen.lt.sm,"md")),k=m(()=>!!r.screen.lt.md),T=m(()=>e.pidmode=="PRESETUP"?"PreSetup":e.pidmode=="LIMIT"?"Limit":e.atpark?"Parked":e.gotoing?"Gotoing":e.slewing?"Slewing":e.rotating?"Rotating":e.ispulseguiding?"Guiding":e.tracking?"Tracking":"Idle"),K=m(()=>e.pidmode=="PRESETUP"||e.pidmode=="LIMIT"?"negative":"positive"),U=m(()=>e.pidmode=="PRESETUP"?"mdi-cellphone-cog":e.pidmode=="LIMIT"?"mdi-alert":e.atpark?"mdi-parking":e.gotoing?"mdi-move-resize-variant":e.slewing?"mdi-cursor-move":e.rotating?"mdi-restore":e.ispulseguiding?"mdi-pulse":e.tracking?"mdi-star-shooting-outline":"mdi-sleep");Z(async()=>{const a=Array.isArray(c.query.api)?c.query.api[0]:c.query.api;a&&(o.restAPIPort=parseInt(a)),!o.alpacaHost&&window.location.hostname&&(o.alpacaHost=window.location.hostname),!o.restAPIPort&&window.location.port&&(o.restAPIPort=parseInt(window.location.port)),o.alpacaHost&&o.restAPIPort&&await o.connectRestAPI()});function w(a){return e.atpark?(r.notify({message:`Cannot ${a} while mount is parked.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):!1}async function F(){const a=await o.alpacaResetSP();console.log(a)}async function H(){if(w("toggle tracking"))return;const a=e.tracking?await o.alpacaTracking(!1):await o.alpacaTracking(!0);console.log(a)}async function y(a){const t=await o.alpacaTrackingRate(a);console.log(t)}async function O(){const a=e.atpark?await o.alpacaUnPark():await o.alpacaPark();console.log(a)}async function V(){if(w("abort"))return;D.value=!1,setTimeout(()=>{D.value=!0},200);const a=await o.alpacaAbortSlew();console.log(a)}async function j(a){if(!w("slew"))if(a.label=="Azimuth"){const t=a.angle,l=e.alpharef[1]??0,d=await o.alpacaSlewToAltAz(l,t);console.log(`Change ${a.label} angle to ${a.angle}`,d)}else if(a.label=="Altitude"){const t=e.alpharef[0]??0,l=a.angle,d=await o.alpacaSlewToAltAz(l,t);console.log(`Change ${a.label} angle to ${a.angle}`,d)}else if(a.label=="Roll"){const t=await o.alpacaMoveMechanical(a.angle);console.log(`Change ${a.label} angle to ${a.angle}`,t)}else if(a.label=="Right Ascension"){const t=a.angle,l=e.deltaref[1]??0,d=await o.alpacaSlewToCoord(t,l);console.log(`Change ${a.label} angle to ${a.angle}`,d)}else if(a.label=="Declination"){const t=e.deltarefRAhrs??0,l=a.angle,d=await o.alpacaSlewToCoord(t,l);console.log(`Change ${a.label} angle to ${a.angle}`,d)}else if(a.label=="Position Angle"){const t=await o.alpacaMoveAbsolute(a.angle);console.log(`Change ${a.label} angle to ${a.angle}`,t)}else console.log(`Click ${a.label} angle: ${a.angle}, offset: ${a.radialOffset}`)}async function G(a){if(w("slew"))return;const t=a.az??e.alpharef[0]??0,l=a.alt??e.alpharef[1]??0;a.roll!==void 0&&await o.alpacaMoveMechanical(a.roll),(a.az!==void 0||a.alt!==void 0)&&await o.alpacaSlewToAltAz(l,t),console.log("Fab Angle:",a)}const Q={Azimuth:0,Altitude:1,Roll:2,"Right Ascension":3,Declination:4,"Position Angle":5};async function J(a){if(console.log("ClickMove ",a.label,a.rateScale),!Object.keys(Q).includes(a.label))return;const t=Q[a.label]??-1,l=t!=3?a.rateScale/200*9:a.rateScale/12*9;t>=0&&t<=5&&await o.apiAction("Polaris:MoveAxis",`{"axis":${t},"rate":${l}}`)}return(a,t)=>(p(),f(ce,{class:"q-pa-sm"},{default:i(()=>[n(ve),_("div",ke,[_("div",be,[_("div",he,[n(le,null,{default:i(()=>[n(A,{icon:"mdi-telescope",glossy:"",dense:k.value,size:v.value,color:"secondary",push:"",outline:!h.value,onClick:t[0]||(t[0]=l=>h.value=!h.value)},null,8,["dense","size","outline"]),N.value?(p(),f(A,{key:0,icon:"mdi-format-horizontal-align-center",glossy:"",dense:k.value,size:v.value,color:"secondary",outline:"",onClick:F},null,8,["dense","size"])):E("",!0),n(A,{icon:"mdi-parking",glossy:"",dense:k.value,size:v.value,color:"secondary",outline:!u(e).atpark,onClick:O},null,8,["dense","size","outline"]),n(A,{icon:"mdi-stop",glossy:"",dense:k.value,size:v.value,color:"secondary",outline:D.value,onClick:V},null,8,["dense","size","outline"])]),_:1}),n(se,{dense:k.value,icon:"mdi-star-shooting-outline",glossy:"",size:v.value,color:"secondary",split:"",outline:!u(e).tracking,onClick:H},{default:i(()=>[n(ne,{dense:""},{default:i(()=>[P((p(),f(S,{clickable:"",active:u(e).trackingrate==0,"active-class":"bg-secondary text-white",onClick:t[1]||(t[1]=l=>y(0))},{default:i(()=>[n(z,null,{default:i(()=>[n(C,null,{default:i(()=>t[5]||(t[5]=[b("Sidereal",-1)])),_:1,__:[5]})]),_:1})]),_:1},8,["active"])),[[$]]),P((p(),f(S,{clickable:"",active:u(e).trackingrate==1,"active-class":"bg-secondary text-white",onClick:t[2]||(t[2]=l=>y(1))},{default:i(()=>[n(z,null,{default:i(()=>[n(C,null,{default:i(()=>t[6]||(t[6]=[b("Lunar",-1)])),_:1,__:[6]})]),_:1})]),_:1},8,["active"])),[[$]]),P((p(),f(S,{clickable:"",active:u(e).trackingrate==2,"active-class":"bg-secondary text-white",onClick:t[3]||(t[3]=l=>y(2))},{default:i(()=>[n(z,null,{default:i(()=>[n(C,null,{default:i(()=>t[7]||(t[7]=[b("Solar",-1)])),_:1,__:[7]})]),_:1})]),_:1},8,["active"])),[[$]]),P((p(),f(S,{clickable:"",active:u(e).trackingrate==3,"active-class":"bg-secondary text-white",onClick:t[4]||(t[4]=l=>y(3))},{default:i(()=>[n(z,null,{default:i(()=>[n(C,null,{default:i(()=>t[8]||(t[8]=[b("Custom",-1)])),_:1,__:[8]})]),_:1})]),_:1},8,["active"])),[[$]])]),_:1})]),_:1},8,["dense","size","outline"])])]),n(ie),n(re,{color:K.value,outline:T.value=="Idle",icon:U.value,class:"q-pa-md"},{default:i(()=>[b(ae(T.value),1)]),_:1},8,["color","outline","icon"])]),_("div",we,[(p(!0),I(oe,null,te(B.value,(l,d)=>(p(),I("div",{key:d,class:"col-12 col-md-6 col-lg-4 col-xl-3"},[n(ge,{label:l.label,pv:l.pv,sp:l.sp,lst:u(e).siderealtime,domain:l.domain,onClickScale:j,onClickFabAngle:G,onClickMove:J},null,8,["label","pv","sp","lst","domain"])]))),128)),u(e).pidmode!="PARK"?(p(),I("div",ye,[n(R,{class:"q-pa-sm",speed:u(e).motorref[0],label:"M1"},null,8,["speed"]),n(R,{class:"q-pa-sm",speed:u(e).motorref[1],label:"M2"},null,8,["speed"]),n(R,{class:"q-pa-sm",speed:u(e).motorref[2],label:"M3"},null,8,["speed"])])):E("",!0)])]),_:1}))}});export{Ze as default};
