import{Q as v}from"./QTooltip-Lk_G8DtN.js";import{a1 as J,ax as W,d as X,a as T,c as h,q as Y,D as Z,E as _,F as n,H as m,I as l,J as z,K as E,Q as w,N as p,M as r,s as C,R as ee,O as Q,T as ae,S as te}from"./index-CZ03DXjz.js";import{Q as oe}from"./QBtnGroup-CXtSZjc-.js";import{Q as P}from"./QItemLabel-DruX3LLc.js";import{Q as S,a as $}from"./QItem-BtFXUANw.js";import{Q as le}from"./QList-DJgI2ntr.js";import{Q as ne}from"./QBtnDropdown-DhJt058H.js";import{Q as se}from"./QSpace-Cbn5n1AE.js";import{Q as ie}from"./QPage-E42FKURz.js";import{g as re,d as ce}from"./position-engine-c61Wc2kP.js";import{u as ue}from"./use-quasar-CmNHKJzh.js";import{u as de}from"./device-BMhOYHwV.js";import{u as pe}from"./status-D38DFJ6c.js";import{a as x,S as me}from"./SpinnerSpeed-CFwHJCwp.js";import{_ as fe}from"./StatusBanners.vue_vue_type_script_setup_true_lang-DhoqC0Bj.js";import{_ as ge}from"./PIDStatus.vue_vue_type_script_setup_true_lang-BB8dyjZN.js";import{e as b}from"./angles-CM-dTGcw.js";import"./use-model-toggle-bobRI_2Q.js";import"./focus-manager-DZlw9dCO.js";import"./use-timeout-BXG4K7JF.js";import"./selection-D2W554fp.js";import"./use-dark-CEgltGwQ.js";import"./QMenu-DhMn_ZMz.js";import"./use-key-composition-CW69J13u.js";import"./QInput-2ibCh1Ax.js";import"./index-DaEgsOZv.js";import"./scale-BUHoRS_z.js";import"./MoveButton.vue_vue_type_script_setup_true_lang-DfOSWfgI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-G3G2U38g.js";function H(i){if(i===!1)return 0;if(i===!0||i===void 0)return 1;const c=parseInt(i,10);return isNaN(c)?0:c}const R=J({name:"close-popup",beforeMount(i,{value:c}){const u={depth:H(c),handler(o){u.depth!==0&&setTimeout(()=>{const t=re(i);t!==void 0&&ce(t,o,u.depth)})},handlerKey(o){W(o,13)===!0&&u.handler(o)}};i.__qclosepopup=u,i.addEventListener("click",u.handler),i.addEventListener("keyup",u.handlerKey)},updated(i,{value:c,oldValue:u}){c!==u&&(i.__qclosepopup.depth=H(c))},beforeUnmount(i){const c=i.__qclosepopup;i.removeEventListener("click",c.handler),i.removeEventListener("keyup",c.handlerKey),delete i.__qclosepopup}}),ve={class:"row q-pa-xs items-center q-col-gutter-sm"},_e={class:"q-pb-sm"},be={class:"q-gutter-md"},ke={class:"row"},we={key:0,class:"col-12 col-md-6 col-lg-4 col-xl-3 row justify-center"},Ye=X({__name:"DashboardPage",setup(i){const c=ue(),u=Z(),o=de(),t=pe(),y=T(!1),D=T(!0),L=h(()=>y.value?[{label:"Right Ascension",pv:t.rightascension,sp:t.deltarefRAhrs,domain:"ra_24"},{label:"Declination",pv:t.declination,sp:t.deltaref[1],domain:"dec_180"},{label:"Position Angle",pv:t.positionangle,sp:t.deltaref[2],domain:"pa_360"}]:[{label:"Azimuth",pv:t.azimuth,sp:t.alpharef[0],domain:"az_360"},{label:"Altitude",pv:t.altitude,sp:t.alpharef[1],domain:"alt_90"},{label:"Roll",pv:t.roll,sp:t.alpharef[2],domain:"roll_180"}]),N=h(()=>{if(t.pidmode!="IDLE")return!1;const e=b(t.rightascension,t.deltarefRAhrs),a=b(t.declination,t.deltaref[1]??0),s=b(t.positionangle,t.deltaref[2]??0),d=b(t.azimuth,t.alpharef[0]??0),I=b(t.altitude,t.alpharef[1]??0),M=b(t.roll,t.alpharef[2]??0);return e*e+a*a+s*s+d*d+I*I+M*M>1}),f=h(()=>(c.screen.lt.sm,"md")),g=h(()=>!!c.screen.lt.md);Y(async()=>{const e=Array.isArray(u.query.api)?u.query.api[0]:u.query.api;e&&(o.restAPIPort=parseInt(e)),!o.alpacaHost&&window.location.hostname&&(o.alpacaHost=window.location.hostname),!o.restAPIPort&&window.location.port&&(o.restAPIPort=parseInt(window.location.port)),o.alpacaHost&&o.restAPIPort&&await o.connectRestAPI()});function k(e){return t.atpark?(c.notify({message:`Cannot ${e} while mount is parked.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):!1}async function B(){const e=await o.alpacaResetSP();console.log(e)}async function K(){if(k("toggle tracking"))return;const e=t.tracking?await o.alpacaTracking(!1):await o.alpacaTracking(!0);console.log(e)}async function A(e){const a=await o.alpacaTrackingRate(e);console.log(a)}async function F(){if(k("find Home"))return;const e=await o.alpacaFindHome();console.log(e)}async function O(){const e=t.atpark?await o.alpacaUnPark():await o.alpacaPark();console.log(e)}async function V(){if(k("abort"))return;D.value=!1,setTimeout(()=>{D.value=!0},200);const e=await o.alpacaAbortSlew();console.log(e)}async function G(e){if(!k("slew"))if(e.label=="Azimuth"){const a=e.angle,s=t.alpharef[1]??0,d=await o.alpacaSlewToAltAz(s,a);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Altitude"){const a=t.alpharef[0]??0,s=e.angle,d=await o.alpacaSlewToAltAz(s,a);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Roll"){const a=await o.alpacaMoveMechanical(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,a)}else if(e.label=="Right Ascension"){const a=e.angle,s=t.deltaref[1]??0,d=await o.alpacaSlewToCoord(a,s);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Declination"){const a=t.deltarefRAhrs??0,s=e.angle,d=await o.alpacaSlewToCoord(a,s);console.log(`Change ${e.label} angle to ${e.angle}`,d)}else if(e.label=="Position Angle"){const a=await o.alpacaMoveAbsolute(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,a)}else console.log(`Click ${e.label} angle: ${e.angle}, offset: ${e.radialOffset}`)}async function j(e){if(k("slew"))return;const a=e.az??t.alpharef[0]??0,s=e.alt??t.alpharef[1]??0;e.roll!==void 0&&await o.alpacaMoveMechanical(e.roll),(e.az!==void 0||e.alt!==void 0)&&await o.alpacaSlewToAltAz(s,a),console.log("Fab Angle:",e)}const q={Azimuth:0,Altitude:1,Roll:2,"Right Ascension":3,Declination:4,"Position Angle":5};async function U(e){if(console.log("ClickMove ",e.label,e.rateScale),!Object.keys(q).includes(e.label))return;const a=q[e.label]??-1,s=a!=3?e.rateScale/200*9:e.rateScale/12*9;a>=0&&a<=5&&await o.apiAction("Polaris:MoveAxis",`{"axis":${a},"rate":${s}}`)}return(e,a)=>(m(),_(ie,{class:"q-pa-sm"},{default:n(()=>[l(fe),z("div",ve,[z("div",_e,[z("div",be,[l(oe,null,{default:n(()=>[l(w,{icon:"mdi-telescope",glossy:"",dense:g.value,size:f.value,color:"secondary",push:"",outline:!y.value,onClick:a[0]||(a[0]=s=>y.value=!y.value)},{default:n(()=>[l(v,null,{default:n(()=>a[5]||(a[5]=[p("Switch between Equatorial and Az/Alt Co-ordinates.",-1)])),_:1,__:[5]})]),_:1},8,["dense","size","outline"]),N.value?(m(),_(w,{key:0,icon:"mdi-format-horizontal-align-center",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:"",onClick:B},{default:n(()=>[l(v,null,{default:n(()=>a[6]||(a[6]=[p("Reset all setpoints to their current values.",-1)])),_:1,__:[6]})]),_:1},8,["dense","size"])):E("",!0),l(w,{icon:"mdi-home",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:r(t).pidmode!="HOMING",onClick:F},{default:n(()=>[l(v,null,{default:n(()=>a[7]||(a[7]=[p("Return the mount to its Home position",-1)])),_:1,__:[7]})]),_:1},8,["dense","size","outline"]),l(w,{icon:"mdi-parking",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:r(t).pidmode!="PARKING",onClick:O},{default:n(()=>[l(v,null,{default:n(()=>a[8]||(a[8]=[p("Return the mount to its Park position.",-1)])),_:1,__:[8]})]),_:1},8,["dense","size","outline"]),l(w,{icon:"mdi-stop",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:D.value,onClick:V},{default:n(()=>[l(v,null,{default:n(()=>a[9]||(a[9]=[p("Stop all motion of the mount.",-1)])),_:1,__:[9]})]),_:1},8,["dense","size","outline"])]),_:1}),l(ne,{dense:g.value,glossy:"",size:f.value,color:"secondary",split:"",outline:!r(t).tracking,onClick:K},{label:n(()=>[l(ee,{name:"mdi-star-shooting-outline"}),l(v,null,{default:n(()=>a[10]||(a[10]=[p("Toggle tracking on and off.",-1)])),_:1,__:[10]})]),default:n(()=>[l(le,{dense:""},{default:n(()=>[C((m(),_(S,{clickable:"",active:r(t).trackingrate==0,"active-class":"bg-secondary text-white",onClick:a[1]||(a[1]=s=>A(0))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>a[11]||(a[11]=[p("Sidereal",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),_(S,{clickable:"",active:r(t).trackingrate==1,"active-class":"bg-secondary text-white",onClick:a[2]||(a[2]=s=>A(1))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>a[12]||(a[12]=[p("Lunar",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),_(S,{clickable:"",active:r(t).trackingrate==2,"active-class":"bg-secondary text-white",onClick:a[3]||(a[3]=s=>A(2))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>a[13]||(a[13]=[p("Solar",-1)])),_:1,__:[13]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),_(S,{clickable:"",active:r(t).trackingrate==3,"active-class":"bg-secondary text-white",onClick:a[4]||(a[4]=s=>A(3))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>a[14]||(a[14]=[p("Custom",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["active"])),[[R]])]),_:1})]),_:1},8,["dense","size","outline"])])]),l(se),l(ge)]),z("div",ke,[(m(!0),Q(te,null,ae(L.value,(s,d)=>(m(),Q("div",{key:d,class:"col-12 col-md-6 col-lg-4 col-xl-3"},[l(me,{label:s.label,pv:s.pv,sp:s.sp,lst:r(t).siderealtime,domain:s.domain,onClickScale:G,onClickFabAngle:j,onClickMove:U},null,8,["label","pv","sp","lst","domain"])]))),128)),r(t).pidmode!="PARK"?(m(),Q("div",we,[l(x,{class:"q-pa-sm",speed:r(t).motorref[0],position:r(t).zetameas[0],label:"M1"},null,8,["speed","position"]),l(x,{class:"q-pa-sm",speed:r(t).motorref[1],position:r(t).zetameas[1],label:"M2"},null,8,["speed","position"]),l(x,{class:"q-pa-sm",speed:r(t).motorref[2],position:r(t).zetameas[2],label:"M3"},null,8,["speed","position"])])):E("",!0)])]),_:1}))}});export{Ye as default};
