import{Q as ce}from"./QSpace-Cbn5n1AE.js";import{d as ve,a as _,c as p,w as V,q as fe,z as _e,B as ge,E as xe,F as s,I as t,J as o,N as i,M as k,Q as E,G as we,Y as be,R as Ke,P as r,H as Pe}from"./index-CZ03DXjz.js";import{Q as L}from"./QBtnToggle-CW8gmeeA.js";import{Q as q,a as c}from"./QItem-BtFXUANw.js";import{Q as v}from"./QItemLabel-DruX3LLc.js";import{Q as ye}from"./QSelect-pEw8DlSn.js";import{Q as G}from"./QList-DJgI2ntr.js";import{Q as O}from"./QCard-j0TR8eB-.js";import{Q as w}from"./QKnob-CQGWedtx.js";import{Q as Ve}from"./QPage-E42FKURz.js";import{u as qe}from"./use-quasar-CmNHKJzh.js";import{_ as Se}from"./StatusBanners.vue_vue_type_script_setup_true_lang-DhoqC0Bj.js";import{C as N}from"./ChartXY-BFIiau9t.js";import{u as he}from"./stream-Dwuq1MzQ.js";import{u as Ce}from"./config-Q1CxDMvj.js";import{u as Qe}from"./device-BMhOYHwV.js";import{u as Te}from"./status-D38DFJ6c.js";import{_ as Y}from"./MoveButton.vue_vue_type_script_setup_true_lang-DfOSWfgI.js";import{_ as De}from"./PIDStatus.vue_vue_type_script_setup_true_lang-BB8dyjZN.js";import{w as ke,a as Ae}from"./angles-CM-dTGcw.js";import"./QBtnGroup-CXtSZjc-.js";import"./use-dark-CEgltGwQ.js";import"./use-key-composition-CW69J13u.js";import"./focus-manager-DZlw9dCO.js";import"./QChip-G3G2U38g.js";import"./QMenu-DhMn_ZMz.js";import"./position-engine-c61Wc2kP.js";import"./selection-D2W554fp.js";import"./use-model-toggle-bobRI_2Q.js";import"./use-timeout-BXG4K7JF.js";import"./use-prevent-scroll-CIi6_vxZ.js";import"./rtl-DFPa-2ov.js";import"./format-BvkBI9bc.js";import"./QCircularProgress-aENvyKNT.js";import"./TouchPan-ZkY2FbWG.js";import"./touch-BjYP5sR0.js";import"./index-DaEgsOZv.js";import"./scale-BUHoRS_z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Me={class:"row q-pb-sm q-col-gutter-md items-center"},Ue={class:"q-gutter-md flex justify-end q-mr-md"},ze={class:"col-auto q-gutter-sm flex justify-end items-center"},Ie={class:"row q-col-gutter-sm items-stretch"},Ge={class:"col-12 flex"},Oe={class:"row"},Re={class:"col-md-6"},Fe={class:"col-md-6 q-pt-sm"},Be={class:"q-gutter-ax"},$e={class:"col-12 col-lg-6 flex"},je={class:"row q-pt-lg q-pl-xl items-top justify-center"},Ee={class:"col row q-gutter-sm"},Le={class:"col row q-gutter-sm"},Ne={class:"row q-pt-lg q-pl-xl items-top justify-center"},Ye={class:"col row q-gutter-sm"},He={class:"col row q-gutter-sm"},Je={class:"col-12 col-lg-6 flex"},Xe={class:"row q-pt-lg q-pl-xl items-top justify-center"},We={class:"col row q-gutter-sm"},Ze={class:"column"},et={class:"text-h6"},tt={class:"col row q-gutter-sm"},ot={class:"column"},at={class:"text-h6"},st={class:"col row q-gutter-sm"},lt={class:"column"},it={class:"text-h6"},Nt=ve({__name:"AnalysePID",setup(nt){const R=qe(),b=he(),u=Ce(),m=Qe(),S=Te(),g=a=>a.toFixed(2),K=_(0),n=_(0),h=_(0),C=_(0),Q=_(0),P=_(0),y=_(0),T=_(0),D=_(0),F=[[{label:"M1",value:0},{label:"M2",value:1},{label:"M3",value:2}],[{label:"Az",value:0},{label:"Alt",value:1},{label:"Roll",value:2}],[{label:"RA ",value:0},{label:"Dec",value:1},{label:"PA ",value:2}]],H=p(()=>F[K.value]??[]),B=p(()=>F[K.value]?.[n.value]?.label??""),J=p(()=>`M${n.value+1}`),$=[{label:"30′ Goto",value:5/60,case:"goto",icon:"mdi-move-resize-variant"},{label:"5° Goto",value:5,case:"goto",icon:"mdi-move-resize-variant"},{label:"45° Goto",value:45,case:"goto",icon:"mdi-move-resize-variant"},{label:"90° Goto",value:90,case:"goto",icon:"mdi-move-resize-variant"},{label:"0.006°/s Slew",value:1,case:"slew",icon:"mdi-arrow-right"},{label:"0.2°/s Slew",value:5.01,case:"slew",icon:"mdi-arrow-right"},{label:"1.0°/s Slew",value:5.87,case:"slew",icon:"mdi-arrow-right"},{label:"200ms Pulse",value:200,case:"pulse",icon:"mdi-pulse"},{label:"2000ms Pulse",value:2e3,case:"pulse",icon:"mdi-pulse"},{label:"5000ms Pulse",value:5e3,case:"pulse",icon:"mdi-pulse"}],x=_($[1]),X=p(()=>g(h.value)),W=p(()=>g(C.value)),Z=p(()=>g(Q.value)),ee=p(()=>g(P.value)),te=p(()=>g(y.value)),oe=p(()=>g(T.value)),ae=p(()=>g(D.value)),A=p(()=>n.value+1),se=p(()=>(b.topics?.pid??[]).map(ue)),le=p(()=>(b.topics?.pid??[]).map(de));V(x,async(a,e)=>{a?.case=="pulse"&&e?.case!="pulse"&&await m.alpacaTracking(!0),a?.case!="pulse"&&e?.case=="pulse"&&await m.alpacaTracking(!1)}),V([h,C,Q,P,y],a=>{const e={pid_Kp:[...u.pid_Kp],pid_Ki:[...u.pid_Ki],pid_Kd:[...u.pid_Kd]};e.pid_Kp[n.value]=a[0],e.pid_Ki[n.value]=a[1],e.pid_Kd[n.value]=a[2],U(e)}),V([P,y],a=>{const e={pid_Ke:a[0],pid_Kc:a[1]};U(e)}),V([T,D],a=>{const e={pid_Kv:a[0],pid_Ka:a[1]};U(e)}),V(n,()=>M());const ie=a=>j(a,-1),ne=a=>j(a,1);async function j(a,e){const d=x.value?.value;if(d===void 0){console.warn("Test case value is undefined");return}if(x.value?.case=="goto"&&a.isPressed)if(await m.alpacaResetSP(),n.value==0){const l=ke(S.azimuth+e*d),f=S.altitude;await m.alpacaSlewToAltAz(f,l)}else if(n.value==1){const l=S.azimuth,f=Ae(S.altitude+e*d);await m.alpacaSlewToAltAz(f,l)}else{const l=S.roll+e*d;await m.alpacaMoveMechanical(l)}else if(x.value?.case=="slew"){await m.alpacaResetSP();const l=a.isPressed;await m.alpacaMoveAxis(n.value,l?e*d:0)}else if(x.value?.case=="pulse"&&a.isPressed)if(n.value==1){const l=e>0?0:1;await m.alpacaPulseGuide(d,l)}else if(n.value==0){const l=e>0?2:3;await m.alpacaPulseGuide(d,l)}else{console.log("pulse test case not implemented for PA axis");return}}function M(){const a=n.value??0;h.value=u.pid_Kp[a]??0,C.value=u.pid_Ki[a]??0,Q.value=u.pid_Kd[a]??0,P.value=u.pid_Ke??0,y.value=u.pid_Kc??0,T.value=u.pid_Kv??0,D.value=u.pid_Ka??0}function ue(a){const e=new Date(a.ts),d=a.data;let l,f;K.value===0?(l="θ_pv",f="θ_sp"):K.value===1?(l="α_pv",f="α_sp"):(l="Δ_pv",f="Δ_sp");const z=d[l]?.[n.value]??0,I=d[f]?.[n.value]??0;return{x1:e,PV:z,SP:I}}function de(a){const e=new Date(a.ts),d=a.data,l=d.ω_op[n.value]??0,f=d.ω_kp[n.value]??0,z=d.ω_ki[n.value]??0,I=d.ω_kd[n.value]??0,me=d.ω_ff[n.value]??0;return{x1:e,Kp:f,Ki:z,Kd:I,FF:me,OP:l}}fe(async()=>{await u.configFetch(),b.subscribe("pid"),M()}),_e(()=>{b.unsubscribe("pid")}),V(()=>m.isVisible,a=>{a?b.subscribe("pid"):b.unsubscribe("pid")});async function re(){const a=await u.configSave();R.notify({message:`Configuration save ${a?"successful":"unsucessful"}.`,type:a?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}async function pe(){const a=await u.configRestore();R.notify({message:`Configuration restore ${a?"successful":"unsucessful"}.`,type:a?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),M()}const U=ge(a=>u.configUpdate(a),500);return(a,e)=>{const d=we("q-markdown");return Pe(),xe(Ve,{class:"q-pa-sm dark-page"},{default:s(()=>[t(Se),o("div",Me,[e[10]||(e[10]=o("div",{class:"col text-h6 q-ml-md"},[i(" Alpaca Driver Performance Analysis "),o("div",{class:"text-caption text-grey-6"}," Use these pages to perform tests and analyse the performance of your Benro Polaris. ")],-1)),t(ce),o("div",Ue,[o("div",ze,[t(E,{rounded:"",color:"grey-9",label:"Save",onClick:re,disable:k(u).isSaving,loading:k(u).isSaving},null,8,["disable","loading"]),t(E,{rounded:"",color:"grey-9",label:"Restore",onClick:pe,disable:k(u).isRestoring,loading:k(u).isRestoring},null,8,["disable","loading"])])])]),o("div",Ie,[o("div",Ge,[t(O,{flat:"",bordered:"",class:"col q-pa-md"},{default:s(()=>[o("div",Oe,[o("div",Re,[t(d,{"no-mark":!1},{default:s(()=>e[11]||(e[11]=[i(`
# PID Controller Tuning
The purpose of the PID controller is to regulate the mount’s motion so that it accurately follows the setpoint position. This page displays the SP, PV, and OP sent to the Speed Controller. The contribution of Kp, Ki, Kd and feed forward are also shown.

Changes to PID gains take effect immediately. Use Save to store your adjustments.
`,-1)])),_:1,__:[11]})]),o("div",Fe,[t(G,null,{default:s(()=>[t(q,null,{default:s(()=>[t(c,{side:"",top:""},{default:s(()=>[t(L,{modelValue:K.value,"onUpdate:modelValue":e[0]||(e[0]=l=>K.value=l),push:"",rounded:"",glossy:"","toggle-color":"primary",options:[{label:"Mot",value:0},{label:"Top",value:1},{label:"Equ",value:2}]},null,8,["modelValue"])]),_:1}),t(c,null,{default:s(()=>[t(v,null,{default:s(()=>e[12]||(e[12]=[i(" Choosen Co-ordinate System",-1)])),_:1,__:[12]}),t(v,{caption:""},{default:s(()=>e[13]||(e[13]=[i(" Choose from Motor Angles, Topocentric or Equatorial. ",-1)])),_:1,__:[13]})]),_:1})]),_:1}),t(q,null,{default:s(()=>[t(c,{side:"",top:""},{default:s(()=>[t(L,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=l=>n.value=l),push:"",rounded:"",glossy:"","toggle-color":"primary",options:H.value},null,8,["modelValue","options"])]),_:1}),t(c,null,{default:s(()=>[t(v,null,{default:s(()=>e[14]||(e[14]=[i(" Choosen Motor Axis",-1)])),_:1,__:[14]}),t(v,{caption:""},{default:s(()=>e[15]||(e[15]=[i(" Select the motor axis you'd like to analyse and tune. ",-1)])),_:1,__:[15]})]),_:1})]),_:1}),t(q,{"inset-level":1},{default:s(()=>[t(c,{top:"",side:""},{default:s(()=>[o("div",Be,[t(ye,{label:"Test Case",modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),options:$},{option:s(l=>[t(q,be({dense:""},l.itemProps),{default:s(()=>[t(c,{avatar:""},{default:s(()=>[t(Ke,{size:"xs",name:l.opt.icon},null,8,["name"])]),_:2},1024),t(c,null,{default:s(()=>[t(v,null,{default:s(()=>[i(r(l.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),t(Y,{activeColor:"positive",icon:"mdi-minus-circle",onPush:ie}),t(Y,{activeColor:"positive",icon:"mdi-plus-circle",onPush:ne})])]),_:1}),t(c,null,{default:s(()=>[t(v,null,{default:s(()=>[i(" Choose Test Case for "+r(B.value),1)]),_:1}),t(v,{caption:""},{default:s(()=>e[16]||(e[16]=[i(" Choose the type and magnitude of the test case. Use the action buttons to move the motor and monitor PID response. ",-1)])),_:1,__:[16]})]),_:1})]),_:1})]),_:1})])])]),_:1})]),o("div",$e,[t(O,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:s(()=>[t(G,null,{default:s(()=>[t(q,null,{default:s(()=>[t(c,null,{default:s(()=>[t(v,null,{default:s(()=>[i(r(B.value)+" Angular Position (degrees) vs Time (seconds)",1)]),_:1}),t(v,{caption:""},{default:s(()=>e[17]||(e[17]=[i("SP: Setpoint Position, PV: Present Value Position",-1)])),_:1,__:[17]})]),_:1}),t(c,{side:"",top:""},{default:s(()=>[t(De)]),_:1})]),_:1})]),_:1}),t(N,{data:se.value,x1Type:"time"},null,8,["data"]),o("div",je,[o("div",Ee,[t(w,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=l=>D.value=l),"show-value":"",min:-.5,"inner-min":0,"inner-max":5,max:5.5,step:.1},{default:s(()=>[i(r(ae.value),1)]),_:1},8,["modelValue"]),e[18]||(e[18]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Ka"),o("div",{class:"text-caption"},"Max OP Acceleration Rate (°/s²)"),o("div",{class:"text-caption"},"0 = Use Default Max")],-1))]),o("div",Le,[t(w,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=l=>T.value=l),"show-value":"",min:-1,"inner-min":0,"inner-max":9.5,max:11,step:.1},{default:s(()=>[i(r(oe.value),1)]),_:1},8,["modelValue"]),e[19]||(e[19]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Kv"),o("div",{class:"text-caption"},"Max OP Slew Velocity (°/s)"),o("div",{class:"text-caption"},"0 = Use Motor Calibration Max")],-1))])]),o("div",Ne,[o("div",Ye,[t(w,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l),"show-value":"",min:-1,"inner-min":.01,"inner-max":10,max:11,step:.01},{default:s(()=>[i(r(te.value),1)]),_:1},8,["modelValue"]),e[20]||(e[20]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Kc"),o("div",{class:"text-caption"},"Goto Tollerance (arc-min)")],-1))]),o("div",He,[t(w,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=l=>P.value=l),"show-value":"",min:-.2,"inner-min":.01,"inner-max":1,max:1.2,step:.01},{default:s(()=>[i(r(ee.value),1)]),_:1},8,["modelValue"]),e[21]||(e[21]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Ke"),o("div",{class:"text-caption"},"Expotential OP Smoothing")],-1))])]),e[22]||(e[22]=o("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[22]})]),o("div",Je,[t(O,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:s(()=>[t(G),t(q,null,{default:s(()=>[t(c,null,{default:s(()=>[t(v,null,{default:s(()=>[i(r(J.value)+" Angular Velocity (degrees/s) vs Time (seconds)",1)]),_:1}),t(v,{caption:""},{default:s(()=>e[23]||(e[23]=[i("OP: Output Velocity, Kp: Proportion, Ki: Integral, Kd: Derivative, FF: Feed Forward",-1)])),_:1,__:[23]})]),_:1})]),_:1}),t(N,{data:le.value,x1Type:"time"},null,8,["data"]),o("div",Xe,[o("div",We,[t(w,{modelValue:h.value,"onUpdate:modelValue":e[7]||(e[7]=l=>h.value=l),"show-value":"",min:-.2,"inner-min":.01,"inner-max":2,max:2.2,step:.01},{default:s(()=>[i(r(X.value),1)]),_:1},8,["modelValue"]),o("div",Ze,[o("div",et,[e[24]||(e[24]=i("Kp",-1)),o("sub",null,r(A.value),1)]),e[25]||(e[25]=o("div",{class:"text-caption"},"Proportional Gain",-1))])]),o("div",tt,[t(w,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=l=>C.value=l),"show-value":"",min:-.1,"inner-min":0,"inner-max":.5,max:.6,step:.01},{default:s(()=>[i(r(W.value),1)]),_:1},8,["modelValue"]),o("div",ot,[o("div",at,[e[26]||(e[26]=i("Ki",-1)),o("sub",null,r(A.value),1)]),e[27]||(e[27]=o("div",{class:"text-caption"},"Integral Gain",-1))])]),o("div",st,[t(w,{modelValue:Q.value,"onUpdate:modelValue":e[9]||(e[9]=l=>Q.value=l),"show-value":"",min:-.2,"inner-min":.01,"inner-max":2,max:2.2,step:.01},{default:s(()=>[i(r(Z.value),1)]),_:1},8,["modelValue"]),o("div",lt,[o("div",it,[e[28]||(e[28]=i("Kd",-1)),o("sub",null,r(A.value),1)]),e[29]||(e[29]=o("div",{class:"text-caption"},"Derivative Gain",-1))])])]),e[30]||(e[30]=o("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[30]})])])]),_:1})}}});export{Nt as default};
