import{Q as lt}from"./QSpace-DAqiMtHk.js";import{d as Z,c as q,q as Y,B as N,E as V,H as p,F as v,J as e,O as f,I as t,R as it,N as x,Q as w,Z as nt,K as _,X as i,M as a,z as at,a as rt,_ as ct,$ as dt}from"./index-3A0wvpxx.js";import{Q as r}from"./QInput-BjDLCijs.js";import{Q as $}from"./QCard-CUgIJt0v.js";import{Q as y}from"./QToggle-ChP4pPL5.js";import{Q as J}from"./QSelect-Br-fsuWv.js";import{Q as ut}from"./QPage-DWChTOEd.js";import{u as mt}from"./use-quasar-CKB869fH.js";import{u as tt}from"./config-COXns40K.js";import{u as et}from"./device-Fa-eSUiN.js";import{u as ot}from"./status-DtdtBqeJ.js";import{_ as pt,g as gt}from"./LocationPicker.vue_vue_type_style_index_0_lang-BZCMHwJf.js";import{f as M}from"./scale-MATHP_kN.js";import{_ as vt}from"./StatusBanners.vue_vue_type_script_setup_true_lang-C60__4fe.js";import{a as E,Q as _t}from"./QItem-BOKhyvdC.js";import{Q as X}from"./QItemLabel-BSZ27Rhy.js";import{Q as ft}from"./QImg-BuDTj5jI.js";import{_ as k}from"./MoveButton.vue_vue_type_script_setup_true_lang-Bz0p7v-I.js";import"./use-key-composition-VDtp_8Zw.js";import"./use-dark-BCnPONtG.js";import"./focus-manager-b7XhsHPR.js";import"./use-checkbox-BlA6sA96.js";import"./QChip-BTW8w38F.js";import"./QMenu-2MD13HI1.js";import"./position-engine-RXU13k3o.js";import"./selection-DwAp0oP7.js";import"./scroll-BR9_nM7t.js";import"./use-model-toggle-dIJI4Fv4.js";import"./use-timeout-D79618hQ.js";import"./use-prevent-scroll-BKis_89Z.js";import"./rtl-DFPa-2ov.js";import"./format-BvkBI9bc.js";import"./_commonjsHelpers-_d1bhYXs.js";import"./angles-gRV9FYwb.js";class ht{intervalId=null;pollFn=null;fnName=null;intervalMs=1e4;constructor(){}startPolling(d,m=10,l){this.fnName=l||d.name||"[anonymous]",console.log(`Starting polling: ${this.fnName} every ${m}s`),this.pollFn=d,this.intervalMs=m*1e3,this.intervalId=window.setInterval(()=>{document.visibilityState==="visible"&&this.pollFn&&Promise.resolve(this.pollFn()).catch(h=>console.warn("Polling function threw:",h))},this.intervalMs)}stopPolling(){this.intervalId!==null&&(console.log(`Stop polling: ${this.fnName}`),clearInterval(this.intervalId),this.intervalId=null)}}const bt="/assets/abp-v2-motor-limits-b-BwHnQsEL.png",yt={class:"row"},xt={key:0,class:"col text-caption text-grey-6 q-pb-md"},wt={key:1,class:"col text-caption text-grey-6 q-pb-md"},qt={class:"row justify-center"},Pt={class:"relative-position",style:{height:"300px",width:"300px"}},kt={class:"row q-col-gutter-lg items-center q-pt-md"},Mt={class:"text-h6"},At={key:0},Ct={class:"row q-col-gutter-lg items-center q-pt-sm"},$t={class:"text-h6"},St={key:0},zt={class:"row q-col-gutter-lg q-pb-md items-center q-pt-sm"},Ft={class:"text-h6"},Vt={key:0},Qt=Z({__name:"MotorLimits",setup(O){const d=et(),m=tt(),l=ot(),h=q(()=>({modelValue:M(l.zetameas[2]??0,"deg",1)})),S=q(()=>({modelValue:M(l.zetameas[1]??0,"deg",1)})),Q=q(()=>({modelValue:M(l.zetameas[0]??0,"deg",1)})),I=q(()=>(l.omegamin?.some(n=>n===0)??!1)||(l.omegamax?.some(n=>n===0)??!1));Y(async()=>{d.restAPIConnected&&d.restAPIConnectedAt&&m.fetchedAt<d.restAPIConnectedAt&&await m.configFetch()});async function L(){console.log("Find Home Position"),await d.alpacaFindHome()}async function z(n){await d.apiAction("Polaris:MoveMotor",`{"axis":0,"rate":${n.isPressed?5:0}}`)}async function j(n){await d.apiAction("Polaris:MoveMotor",`{"axis":0,"rate":${n.isPressed?-5:0}}`)}async function B(n){await d.apiAction("Polaris:MoveMotor",`{"axis":1,"rate":${n.isPressed?5:0}}`)}async function R(n){await d.apiAction("Polaris:MoveMotor",`{"axis":1,"rate":${n.isPressed?-5:0}}`)}async function c(n){await d.apiAction("Polaris:MoveMotor",`{"axis":2,"rate":${n.isPressed?5:0}}`)}async function A(n){await d.apiAction("Polaris:MoveMotor",`{"axis":2,"rate":${n.isPressed?-5:0}}`)}function b(n,u,T){const F=m[n],C=typeof F,P=["string","number","boolean"].includes(C);return{label:u,suffix:T,modelValue:P?F:"","onUpdate:modelValue":s=>{if(s!==null&&P){m[n]=s;const o={[n]:s};H(o)}}}}const H=N(n=>m.configUpdate(n),5);return(n,u)=>(p(),V($,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:v(()=>[u[6]||(u[6]=e("div",{class:"text-h6"},"Motor Angle Limts",-1)),e("div",yt,[I.value?(p(),f("div",xt,[t(_t,null,{default:v(()=>[t(E,{avatar:""},{default:v(()=>[t(it,{name:"mdi-alert",color:"negative",size:"lg"})]),_:1}),t(E,null,{default:v(()=>[t(X,null,{default:v(()=>u[1]||(u[1]=[x("Anti-windup Motor Angle Limit Reached",-1)])),_:1,__:[1]}),t(X,{class:"text-grey-6",caption:""},{default:v(()=>u[2]||(u[2]=[x("Use the buttons M1+, M1-, etc to move the mount back to safety. Alternitively issue a Home command. ",-1)])),_:1,__:[2]})]),_:1}),t(E,{side:""},{default:v(()=>[t(w,{label:"Home",icon:"mdi-home",class:"fixedWidth",onClick:L})]),_:1})]),_:1})])):(p(),f("div",wt," To prevent cable windup, define minimum and maximum angle limits for each axis. Values beyond ±360° indicate the number of full rotations permitted in that direction. Axis M2 is mechanically limited. "))]),e("div",qt,[e("div",Pt,[t(ft,{src:bt,fit:"scale-down",onContextmenu:u[0]||(u[0]=nt(()=>{},["prevent"]))}),t(k,{activeColor:"positive",label:"M3+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:c,class:"absolute",style:{top:"2%",left:"47%"}}),t(k,{activeColor:"positive",label:"M3-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:A,class:"absolute",style:{top:"2%",left:"77%"}}),t(k,{activeColor:"positive",label:"M2+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:B,class:"absolute",style:{top:"43%",left:"38%"}}),t(k,{activeColor:"positive",label:"M2-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:R,class:"absolute",style:{top:"66%",left:"25%"}}),t(k,{activeColor:"positive",label:"M1+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:z,class:"absolute",style:{top:"79%",left:"11%"}}),t(k,{activeColor:"positive",label:"M1-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:j,class:"absolute",style:{top:"91%",left:"30%"}})])]),e("div",kt,[e("div",Mt,[u[3]||(u[3]=x("M3 ",-1)),n.$q.screen.gt.xs?(p(),f("span",At,"Axis")):_("",!0)]),t(r,i({class:"col-3"},b("z3_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamin[2]===0?"negative":void 0}),null,16,["bg-color"]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},h.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},b("z3_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamax[2]===0?"negative":void 0}),null,16,["bg-color"])]),e("div",Ct,[e("div",$t,[u[4]||(u[4]=x("M2 ",-1)),n.$q.screen.gt.xs?(p(),f("span",St,"Axis")):_("",!0)]),t(r,i({class:"col-3"},b("z2_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamin[1]===0?"negative":void 0}),null,16,["bg-color"]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},S.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},b("z2_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamax[1]===0?"negative":void 0}),null,16,["bg-color"])]),e("div",zt,[e("div",Ft,[u[5]||(u[5]=x("M1 ",-1)),n.$q.screen.gt.xs?(p(),f("span",Vt,"Axis")):_("",!0)]),t(r,i({class:"col-3"},b("z1_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamin[0]===0?"negative":void 0}),null,16,["bg-color"]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},Q.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},b("z1_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":a(l).omegamax[0]===0?"negative":void 0}),null,16,["bg-color"])])]),_:1,__:[6]}))}}),It={class:"row q-pb-sm q-col-gutter-md items-center"},Lt={class:"col text-h6 q-ml-md"},jt={key:0,class:"text-caption text-grey-6"},Bt={class:"q-gutter-md flex justify-end q-mr-md"},Rt={class:"col-auto q-gutter-sm flex justify-end items-center"},Ht={class:"row q-col-gutter-sm items-stretch"},Tt={class:"col-12 col-md-6 col-lg-4 flex"},Ut={class:"row q-col-gutter-lg items-center"},Et={class:"col-auto q-gutter-sm flex justify-end items-center"},Nt={class:"q-pt-md q-pb-md"},Ot={class:"row q-col-gutter-lg q-pb-md"},Gt={class:"row q-col-gutter-lg"},Dt={class:"col-12 col-md-6 col-lg-4 flex"},Kt={class:"row"},Wt={class:"col-auto q-gutter-sm flex justify-end items-center"},Jt={class:"row"},Xt={class:"col-auto q-gutter-sm flex justify-end items-center"},Zt={class:"row"},Yt={class:"col-auto q-gutter-sm flex justify-end items-center"},te={class:"q-gutter-y-sm"},ee={class:"row q-col-gutter-lg items-center q-pt-md"},oe={class:"text-h6"},se={key:0},le={class:"row q-col-gutter-lg items-center q-pt-sm"},ie={class:"text-h6"},ne={key:0},ae={class:"row q-col-gutter-lg q-pb-md items-center q-pt-sm"},re={class:"text-h6"},ce={key:0},de={class:"col-12 col-md-6 col-lg-4 flex"},ue={class:"col-12 col-md-6 col-lg-4 flex"},me={class:"row q-col-gutter-lg items-center"},pe={class:"col-auto q-gutter-sm flex justify-end"},ge={key:0,class:"q-gutter-y-sm"},ve={class:"row"},_e={class:"row"},fe={class:"row"},he={class:"row q-pb-md"},be={key:0,class:"row q-col-gutter-lg q-pl-md q-pr-mdn"},ye={class:"col-12 col-md-6 col-lg-4 flex"},xe={class:"q-gutter-y-sm"},we={class:"row"},qe={class:"row"},Pe={class:"row q-pt-md q-pl-md q-col-gutter-lg"},io=Z({__name:"ConfigPage",setup(O){const d=mt(),m=et(),l=tt(),h=ot(),S=new ht,Q=q(()=>({modelValue:M(h.zetameas[2]??0,"deg",1)})),I=q(()=>({modelValue:M(h.zetameas[1]??0,"deg",1)})),L=q(()=>({modelValue:M(h.zetameas[0]??0,"deg",1)})),z=[{label:"0.25× sidereal",value:.25},{label:"0.50× sidereal",value:.5},{label:"0.75× sidereal",value:.75},{label:"1.00× sidereal",value:1},{label:"1.25× sidereal",value:1.25},{label:"1.50× sidereal",value:1.5},{label:"2.00× sidereal",value:2}];Y(async()=>{m.restAPIConnected&&m.restAPIConnectedAt&&l.fetchedAt<m.restAPIConnectedAt&&await l.configFetch(),S.startPolling(()=>{l.configFetch()},10,"configFetch")}),at(()=>{S.stopPolling()});async function j(){const s=await m.alpacaFindHome();console.log(s)}async function B(){const s=h.atpark?await m.alpacaUnPark():await m.alpacaPark();console.log(s)}async function R(){const s=await m.alpacaSetPark();d.notify({message:"The mounts Park Postion has been set to the current orientation.",type:"positive",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]});const o=await l.configFetch();b(["m1_park","m2_park","m3_park"]),console.log(s,o)}function c(s,o,g){const G=l[s],D=typeof G,K=["string","number","boolean"].includes(D),st=D==="boolean";return{label:o,...g?{suffix:g}:{},class:{taflash:A.value.has(s)},modelValue:K?G:"","onUpdate:modelValue":U=>{if(U!==null&&K){l[s]=U;const W={[s]:U};st?P(W):C(W)}}}}const A=rt(new Set);function b(s){s.forEach(o=>A.value.add(o)),setTimeout(()=>{s.forEach(o=>A.value.delete(o))},600)}async function H(){const s=await gt();s.success&&(P(s.data),b(Object.keys(s.data)))}function n(s){s.success&&(P(s.data),b(Object.keys(s.data)))}async function u(){const s=await l.configSave();d.notify({message:`Configuration save ${s?"successful":"unsucessful"}.`,type:s?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}async function T(){const s=await l.configRestore();d.notify({message:`Configuration restore ${s?"successful":"unsucessful"}.`,type:s?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}async function F(s){console.log("L-Bracket set to ",s),await m.setPolarisLBracket(s)}const C=N(s=>l.configUpdate(s),500),P=N(s=>l.configUpdate(s),5);return(s,o)=>(p(),V(ut,{class:"q-pa-sm"},{default:v(()=>[t(vt),e("div",null,[e("div",It,[e("div",Lt,[o[5]||(o[5]=x(" Alpaca Driver Settings ",-1)),a(d).screen.gt.xs?(p(),f("div",jt," Settings take effect instantly. Click Save to persist after restart, or Restore to revert to Config.toml defaults. ")):_("",!0)]),t(lt),e("div",Bt,[e("div",Rt,[t(w,{rounded:"",color:"grey-9",label:"Save",onClick:u,disable:a(l).isSaving,loading:a(l).isSaving},null,8,["disable","loading"]),t(w,{rounded:"",color:"grey-9",label:"Restore",onClick:T,disable:a(l).isRestoring,loading:a(l).isRestoring},null,8,["disable","loading"])])])]),e("div",Ht,[e("div",Tt,[t($,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:v(()=>[o[7]||(o[7]=e("div",{class:"text-h6"},"Observing Site Information",-1)),e("div",Ut,[o[6]||(o[6]=e("div",{class:"col text-caption text-grey-6 q-pb-md"}," Latitude and longitude are essential for accurate tracking. Other settings follow the ASCOM Alpaca standard and are optional. ",-1)),e("div",Et,[t(w,{outline:"",icon:"mdi-crosshairs-gps",color:"grey-5",label:"Locate",onClick:H})])]),e("div",Nt,[t(pt,{lat:a(l).site_latitude,lon:a(l).site_longitude,onLocationInfo:n},null,8,["lat","lon"])]),e("div",Ot,[t(r,i({class:"col-3"},c("site_latitude","Latitude","°"),{type:"number","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("site_longitude","Longitude","°"),{type:"number","input-class":"text-right"}),null,16),t(r,i({class:"col-6"},c("location","Location")),null,16)]),e("div",Gt,[t(r,i({class:"col-3"},c("site_elevation","Elevation","m"),{type:"number","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("site_pressure","Pressure","hPa"),{type:"number","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("focal_length","Focal Length","mm"),{type:"number","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("focal_ratio","Focal Ratio","f-stop"),{type:"number","input-class":"text-right"}),null,16)])]),_:1,__:[7]})]),e("div",Dt,[t($,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:v(()=>[o[14]||(o[14]=e("div",{class:"text-h6"},"Home Position",-1)),e("div",Kt,[o[8]||(o[8]=e("div",{class:"col text-caption text-grey-6 q-pb-md"}," The home position is the mount’s fixed mechanical reference point, where all motor angles are zero. When commanded to find home, the mount will unwind any accumulated rotation in motors M1 and M3. ",-1)),e("div",Wt,[t(w,{outline:"",icon:"mdi-home",color:"grey-5",label:"Home",onClick:j})])]),o[15]||(o[15]=e("div",{class:"text-h6"},"Park Position",-1)),e("div",Jt,[o[9]||(o[9]=e("div",{class:"col text-caption text-grey-6 q-pb-md"}," The park position is a user-defined resting position that the mount can return to when not in use. ",-1)),e("div",Xt,[t(w,{outline:"",icon:"mdi-parking",color:"grey-5",label:"Park",onClick:B})])]),e("div",Zt,[o[10]||(o[10]=e("div",{class:"col text-caption text-grey-6 q-pb-md"}," Select Park Save to store the mount’s current orientation as the new park position. ",-1)),e("div",Yt,[t(w,{outline:"",icon:"mdi-car-brake-parking",color:"grey-5",label:"SAVE",onClick:R})])]),e("div",te,[e("div",ee,[e("div",oe,[o[11]||(o[11]=x("M3 ",-1)),a(d).screen.gt.xs?(p(),f("span",se,"Axis")):_("",!0)]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},Q.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("m3_park","Park Angle","°"),{type:"number","input-class":"text-right",dense:""}),null,16)]),e("div",le,[e("div",ie,[o[12]||(o[12]=x("M2 ",-1)),a(d).screen.gt.xs?(p(),f("span",ne,"Axis")):_("",!0)]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},I.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("m2_park","Park Angle","°"),{type:"number","input-class":"text-right",dense:""}),null,16)]),e("div",ae,[e("div",re,[o[13]||(o[13]=x("M1 ",-1)),a(d).screen.gt.xs?(p(),f("span",ce,"Axis")):_("",!0)]),t(r,i({dense:"",class:"col-3",readonly:"",label:"Current"},L.value,{type:"text","input-class":"text-right"}),null,16),t(r,i({class:"col-3"},c("m1_park","Park Angle","°"),{type:"number","input-class":"text-right",dense:""}),null,16)])])]),_:1,__:[14,15]})]),e("div",de,[t(Qt)]),e("div",ue,[t($,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:v(()=>[o[18]||(o[18]=e("div",{class:"text-h6"},"Advanced Control Features",-1)),e("div",me,[o[16]||(o[16]=e("div",{class:"col text-caption text-grey-6 q-pb-md"}," Use Advanced Position Control to override the Benro Polaris default behaviour. Toggle individual features below to enable advanced slewing, goto, tracking, guiding and rotator support. ",-1)),e("div",pe,[t(y,i({class:"col"},c("advanced_control","Enable")),null,16)])]),a(l).advanced_control?(p(),f("div",ge,[e("div",ve,[t(y,i({class:"col-6"},c("advanced_kf","Kalman Filtering")),null,16),t(y,i({class:"col-6"},c("advanced_rotator","Alpaca Rotator")),null,16)]),e("div",_e,[t(y,i({class:"col-6"},c("advanced_slewing","Slewing")),null,16),t(y,i({class:"col-6"},c("advanced_goto","Advanced Goto")),null,16)]),e("div",fe,[t(y,i({class:"col-6"},c("advanced_tracking","Tracking")),null,16),t(y,i({class:"col-6"},c("advanced_alignment","Multi-Point Alignment")),null,16)]),e("div",he,[t(y,i({class:"col-6"},c("advanced_guiding","Pulse Guiding")),null,16)]),a(l).advanced_guiding?(p(),f("div",be,[t(J,{class:"col-6 q-pt-none",label:"RA Pulse Guide Rate","emit-value":"","map-options":"",modelValue:a(l).guide_rate_ra,"onUpdate:modelValue":[o[0]||(o[0]=g=>a(l).guide_rate_ra=g),o[1]||(o[1]=g=>a(C)({guide_rate_ra:g}))],options:z},null,8,["modelValue"]),t(J,{class:"col-6 q-pt-none",label:"Dec Pulse Guide Rate","emit-value":"","map-options":"",modelValue:a(l).guide_rate_dec,"onUpdate:modelValue":[o[2]||(o[2]=g=>a(l).guide_rate_dec=g),o[3]||(o[3]=g=>a(C)({guide_rate_dec:g}))],options:z},null,8,["modelValue"])])):_("",!0),o[17]||(o[17]=e("div",{class:"q-pb-md"},null,-1))])):_("",!0)]),_:1,__:[18]})]),e("div",ye,[t($,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:v(()=>[o[19]||(o[19]=e("div",{class:"text-h6"},"Standard Control Features",-1)),o[20]||(o[20]=e("div",{class:"row"},[e("div",{class:"col-12 text-caption text-grey-6 q-pb-md"}," Aiming Adjustment improves the standard Benro Polaris Goto performance, by correcting any aiming bias, and by forward calculating co-ordinates into the future. ")],-1)),e("div",xe,[e("div",we,[t(y,{modelValue:a(h).polarislbracket,"onUpdate:modelValue":[o[4]||(o[4]=g=>a(h).polarislbracket=g),F],label:"Enable L-Bracket Camera Orientation"},null,8,["modelValue"])]),e("div",qe,[t(y,ct(dt(c("aiming_adjustment_enabled","Enable Aiming Adjustment"))),null,16)]),e("div",Pe,[a(l).aiming_adjustment_enabled?(p(),V(r,i({key:0,class:"col-4"},c("aim_max_error_correction","Max Bias Correction","°"),{type:"number","input-class":"text-right"}),null,16)):_("",!0),a(l).aiming_adjustment_enabled?(p(),V(r,i({key:1,class:"col-4"},c("aiming_adjustment_time","Future offset Time","s"),{type:"number","input-class":"text-right"}),null,16)):_("",!0),t(r,i({class:"col-4"},c("tracking_settle_time","Tracking Settle Time","s"),{type:"number","input-class":"text-right"}),null,16)])])]),_:1,__:[19,20]})])])])]),_:1}))}});export{io as default};
