import{Q as _e}from"./QSpace-D5Vfw6GG.js";import{d as ge,a as _,c as m,w as V,q as xe,D as be,z as we,B as Ke,E as Pe,F as a,I as t,J as o,N as i,M as A,Q as L,G as N,X as ye,R as Ve,P as p,H as qe}from"./index-Dx5-9Vdh.js";import{Q as X}from"./QBtnToggle-CD56g1ca.js";import{Q as q,a as v}from"./QItem-s6vDCOg1.js";import{Q as f}from"./QItemLabel-DKkNeboc.js";import{Q as Se}from"./QSelect-77XOzaY3.js";import{Q as G}from"./QList-B4l1-2kl.js";import{Q as O}from"./QCard-C7HQvmZy.js";import{Q as H,a as b}from"./QExpansionItem-CL9oQXny.js";import{Q as Ce}from"./QPage-BWSMpfuG.js";import{u as Qe}from"./use-quasar-BWFx9zZ-.js";import{u as De}from"./stream-CFeLzzJU.js";import{u as Te}from"./config-ClasVhDl.js";import{u as he}from"./device-DZEmto42.js";import{u as Ae}from"./status-Bahpu37M.js";import{_ as ke}from"./StatusBanners.vue_vue_type_script_setup_true_lang-CGo07ZQ6.js";import{C as J}from"./ChartXY-Dfoyn3XW.js";import{_ as Y}from"./MoveButton.vue_vue_type_script_setup_true_lang-jwjpseFd.js";import{_ as Me}from"./PIDStatus.vue_vue_type_script_setup_true_lang-WZ1EOD_k.js";import{w as Ue,a as Ie}from"./angles-gRV9FYwb.js";import"./QBtnGroup-BoLqx3yL.js";import"./use-dark-T81UEqai.js";import"./use-key-composition-kbOA9dE_.js";import"./use-id-BbGOx_an.js";import"./focus-manager-BgDhIfI5.js";import"./QChip-lBDG_gZP.js";import"./QMenu-CpxXjDTb.js";import"./position-engine-CQzgbBDW.js";import"./selection-YUnCNymy.js";import"./scroll-wxDRc04d.js";import"./use-model-toggle-EtaFIrcD.js";import"./use-timeout-Bk_lgB95.js";import"./use-prevent-scroll-gmdmOWwQ.js";import"./rtl-DFPa-2ov.js";import"./format-BvkBI9bc.js";import"./QCircularProgress-Dx9CMSwY.js";import"./TouchPan-De0OJQYa.js";import"./touch-BjYP5sR0.js";import"./QSeparator-B9Na72Tv.js";import"./index-DaEgsOZv.js";import"./scale-MATHP_kN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"row q-pb-sm q-col-gutter-md items-center"},Ge={class:"q-gutter-md flex justify-end q-mr-md"},Oe={class:"col-auto q-gutter-sm flex justify-end items-center"},Re={class:"row q-col-gutter-sm items-stretch"},Fe={class:"col-12 flex"},$e={class:"row"},Be={class:"col-md-6"},je={class:"col-md-6 q-pt-sm"},Ee={class:"q-gutter-ax"},Le={class:"col-12 col-lg-6 flex"},Ne={class:"row q-pt-lg q-pl-xl items-top justify-center"},Xe={class:"col row q-gutter-sm"},He={class:"col row q-gutter-sm"},Je={class:"row q-pt-lg q-pl-xl items-top justify-center"},Ye={class:"col row q-gutter-sm"},We={class:"col row q-gutter-sm"},Ze={class:"col-12 col-lg-6 flex"},et={class:"row q-pt-lg q-pl-xl items-top justify-center"},tt={class:"col row q-gutter-sm"},ot={class:"column"},lt={class:"text-h6"},at={class:"col row q-gutter-sm"},st={class:"column"},it={class:"text-h6"},nt={class:"col row q-gutter-sm"},ut={class:"column"},dt={class:"text-h6"},Zt=ge({__name:"AnalysePID",setup(rt){const R=Qe(),w=De(),d=Te(),c=he(),S=Ae(),W=be(),g=l=>l.toFixed(2),K=_(2),n=_(0),C=_(0),Q=_(0),D=_(0),P=_(0),y=_(0),T=_(0),h=_(0),F=[[{label:"M1",value:0},{label:"M2",value:1},{label:"M3",value:2}],[{label:"Az",value:0},{label:"Alt",value:1},{label:"Roll",value:2}],[{label:"RA ",value:0},{label:"Dec",value:1},{label:"PA ",value:2}]],Z=m(()=>F[K.value]??[]),$=m(()=>F[K.value]?.[n.value]?.label??""),B=m(()=>`M${n.value+1}`),j=[{label:"30′ Goto",value:5/60,case:"goto",icon:"mdi-move-resize-variant"},{label:"5° Goto",value:5,case:"goto",icon:"mdi-move-resize-variant"},{label:"45° Goto",value:45,case:"goto",icon:"mdi-move-resize-variant"},{label:"90° Goto",value:90,case:"goto",icon:"mdi-move-resize-variant"},{label:"0.006°/s Slew",value:1,case:"slew",icon:"mdi-arrow-right"},{label:"0.2°/s Slew",value:5.01,case:"slew",icon:"mdi-arrow-right"},{label:"1.0°/s Slew",value:5.87,case:"slew",icon:"mdi-arrow-right"},{label:"200ms Pulse",value:200,case:"pulse",icon:"mdi-pulse"},{label:"2000ms Pulse",value:2e3,case:"pulse",icon:"mdi-pulse"},{label:"5000ms Pulse",value:5e3,case:"pulse",icon:"mdi-pulse"}],x=_(j[1]),ee=m(()=>g(C.value)),te=m(()=>g(Q.value)),oe=m(()=>g(D.value)),le=m(()=>g(P.value)),ae=m(()=>g(y.value)),se=m(()=>g(T.value)),ie=m(()=>g(h.value)),k=m(()=>n.value+1),ne=m(()=>(w.topics?.pid??[]).map(pe)),ue=m(()=>(w.topics?.pid??[]).map(me));V(x,async(l,e)=>{l?.case=="pulse"&&e?.case!="pulse"&&await c.alpacaTracking(!0),l?.case!="pulse"&&e?.case=="pulse"&&await c.alpacaTracking(!1)}),V([C,Q,D,P,y],l=>{const e={pid_Kp:[...d.pid_Kp],pid_Ki:[...d.pid_Ki],pid_Kd:[...d.pid_Kd]};e.pid_Kp[n.value]=l[0],e.pid_Ki[n.value]=l[1],e.pid_Kd[n.value]=l[2],U(e)}),V([P,y],l=>{const e={pid_Ke:l[0],pid_Kc:l[1]};U(e)}),V([T,h],l=>{const e={pid_Kv:l[0],pid_Ka:l[1]};U(e)}),V(n,()=>M());const de=l=>E(l,-1),re=l=>E(l,1);async function E(l,e){const r=x.value?.value;if(r===void 0){console.warn("Test case value is undefined");return}if(x.value?.case=="goto"&&l.isPressed)if(await c.alpacaResetSP(),n.value==0){const u=Ue(S.azimuth+e*r),s=S.altitude;await c.alpacaSlewToAltAz(s,u)}else if(n.value==1){const u=S.azimuth,s=Ie(S.altitude+e*r);await c.alpacaSlewToAltAz(s,u)}else{const u=S.roll+e*r;await c.alpacaMoveMechanical(u)}else if(x.value?.case=="slew"){await c.alpacaResetSP();const u=l.isPressed;await c.alpacaMoveAxis(n.value,u?e*r:0)}else if(x.value?.case=="pulse"&&l.isPressed)if(n.value==1){const u=e>0?0:1;await c.alpacaPulseGuide(r,u)}else if(n.value==0){const u=e>0?2:3;await c.alpacaPulseGuide(r,u)}else{console.log("pulse test case not implemented for PA axis");return}}function M(){const l=n.value??0;C.value=d.pid_Kp[l]??0,Q.value=d.pid_Ki[l]??0,D.value=d.pid_Kd[l]??0,P.value=d.pid_Ke??0,y.value=d.pid_Kc??0,T.value=d.pid_Kv??0,h.value=d.pid_Ka??0}function pe(l){const e=new Date(l.ts),r=l.data;let u,s;K.value===0?(u="θ_pv",s="θ_sp"):K.value===1?(u="α_pv",s="α_sp"):(u="Δ_pv",s="Δ_sp");const I=r[u]?.[n.value]??0,z=r[s]?.[n.value]??0;return{x1:e,PV:I,SP:z}}function me(l){const e=new Date(l.ts),r=l.data,u=r.ω_op[n.value]??0,s=r.ω_kp[n.value]??0,I=r.ω_ki[n.value]??0,z=r.ω_kd[n.value]??0,fe=r.ω_ff[n.value]??0;return{x1:e,Kp:s,Ki:I,Kd:z,FF:fe,OP:u}}xe(async()=>{const l=parseInt(W.query.a);n.value=[0,1,2].includes(l)?l:0,await d.configFetch(),w.subscribe("pid"),M()}),we(()=>{w.unsubscribe("pid")}),V(()=>c.isVisible,l=>{l?w.subscribe("pid"):w.unsubscribe("pid")});async function ce(){const l=await d.configSave();R.notify({message:`Configuration save ${l?"successful":"unsucessful"}.`,type:l?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}async function ve(){const l=await d.configRestore();R.notify({message:`Configuration restore ${l?"successful":"unsucessful"}.`,type:l?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),M()}const U=Ke(l=>d.configUpdate(l),500);return(l,e)=>{const r=N("q-markdown"),u=N("router-link");return qe(),Pe(Ce,{class:"q-pa-sm dark-page"},{default:a(()=>[t(ke),o("div",ze,[e[10]||(e[10]=o("div",{class:"col text-h6 q-ml-md"},[i(" Alpaca Driver Performance Analysis "),o("div",{class:"text-caption text-grey-6"}," Use these pages to perform tests and analyse the performance of your Benro Polaris. ")],-1)),t(_e),o("div",Ge,[o("div",Oe,[t(L,{rounded:"",color:"grey-9",label:"Save",onClick:ce,disable:A(d).isSaving,loading:A(d).isSaving},null,8,["disable","loading"]),t(L,{rounded:"",color:"grey-9",label:"Restore",onClick:ve,disable:A(d).isRestoring,loading:A(d).isRestoring},null,8,["disable","loading"])])])]),o("div",Re,[o("div",Fe,[t(O,{flat:"",bordered:"",class:"col q-pa-md"},{default:a(()=>[o("div",$e,[o("div",Be,[t(r,{"no-mark":!1},{default:a(()=>e[11]||(e[11]=[i(`
# PID Controller Tuning
The purpose of the PID controller is to regulate the mount’s motion so that it accurately follows the setpoint position. This page displays the SP, PV, and OP sent to the Speed Controller. The contribution of Kp, Ki, Kd and feed forward are also shown.

Changes to PID gains take effect immediately. Use Save to store your adjustments.
`,-1)])),_:1,__:[11]})]),o("div",je,[t(G,null,{default:a(()=>[t(q,null,{default:a(()=>[t(v,{side:"",top:""},{default:a(()=>[t(X,{modelValue:K.value,"onUpdate:modelValue":e[0]||(e[0]=s=>K.value=s),push:"",rounded:"",glossy:"","toggle-color":"primary",options:[{label:"Mot",value:0},{label:"Top",value:1},{label:"Equ",value:2}]},null,8,["modelValue"])]),_:1}),t(v,null,{default:a(()=>[t(f,null,{default:a(()=>e[12]||(e[12]=[i(" Choosen Co-ordinate System",-1)])),_:1,__:[12]}),t(f,{caption:""},{default:a(()=>e[13]||(e[13]=[i(" Choose from Motor Angles, Topocentric or Equatorial. ",-1)])),_:1,__:[13]})]),_:1})]),_:1}),t(q,null,{default:a(()=>[t(v,{side:"",top:""},{default:a(()=>[t(X,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value=s),push:"",rounded:"",glossy:"","toggle-color":"primary",options:Z.value},null,8,["modelValue","options"])]),_:1}),t(v,null,{default:a(()=>[t(f,null,{default:a(()=>e[14]||(e[14]=[i(" Choosen Motor Axis",-1)])),_:1,__:[14]}),t(f,{caption:""},{default:a(()=>[e[16]||(e[16]=i(" Select the motor axis you'd like to analyse and tune. Or monitor ",-1)),t(u,{to:"/pidall",class:"text-primary text-bold"},{default:a(()=>e[15]||(e[15]=[i("All Axes",-1)])),_:1,__:[15]}),e[17]||(e[17]=i(". ",-1))]),_:1,__:[16,17]})]),_:1})]),_:1}),t(q,{"inset-level":1},{default:a(()=>[t(v,{top:"",side:""},{default:a(()=>[o("div",Ee,[t(Se,{label:"Test Case",modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=s=>x.value=s),options:j},{option:a(s=>[t(q,ye({dense:""},s.itemProps),{default:a(()=>[t(v,{avatar:""},{default:a(()=>[t(Ve,{size:"xs",name:s.opt.icon},null,8,["name"])]),_:2},1024),t(v,null,{default:a(()=>[t(f,null,{default:a(()=>[i(p(s.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue"]),t(Y,{activeColor:"positive",icon:"mdi-minus-circle",onPush:de}),t(Y,{activeColor:"positive",icon:"mdi-plus-circle",onPush:re})])]),_:1}),t(v,null,{default:a(()=>[t(f,null,{default:a(()=>[i(" Choose Test Case for "+p($.value),1)]),_:1}),t(f,{caption:""},{default:a(()=>e[18]||(e[18]=[i(" Choose the type and magnitude of the test case. Use the action buttons to move the motor and monitor PID response. ",-1)])),_:1,__:[18]})]),_:1})]),_:1})]),_:1})])])]),_:1})]),o("div",Le,[t(O,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:a(()=>[t(G,null,{default:a(()=>[t(q,null,{default:a(()=>[t(v,null,{default:a(()=>[t(f,null,{default:a(()=>[i(p($.value)+" Angular Position (degrees) vs Time (seconds)",1)]),_:1}),t(f,{caption:""},{default:a(()=>e[19]||(e[19]=[i("SP: Setpoint Position, PV: Present Value Position",-1)])),_:1,__:[19]})]),_:1}),t(v,{side:"",top:""},{default:a(()=>[t(Me)]),_:1})]),_:1})]),_:1}),t(J,{data:ne.value,x1Type:"time"},null,8,["data"]),t(H,{label:"Advanced Global PID Settings"},{default:a(()=>[o("div",Ne,[o("div",Xe,[t(b,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),"show-value":"",min:-.5,"inner-min":0,"inner-max":5,max:5.5,step:.1},{default:a(()=>[i(p(ie.value),1)]),_:1},8,["modelValue"]),e[20]||(e[20]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Ka"),o("div",{class:"text-caption"},"Max OP Acceleration Rate (°/s²)"),o("div",{class:"text-caption"},"0 = Use Default Max")],-1))]),o("div",He,[t(b,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=s=>T.value=s),"show-value":"",min:-1,"inner-min":0,"inner-max":9.5,max:11,step:.1},{default:a(()=>[i(p(se.value),1)]),_:1},8,["modelValue"]),e[21]||(e[21]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Kv"),o("div",{class:"text-caption"},"Max OP Slew Velocity (°/s)"),o("div",{class:"text-caption"},"0 = Use Motor Calibration Max")],-1))])]),o("div",Je,[o("div",Ye,[t(b,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=s=>y.value=s),"show-value":"",min:-1,"inner-min":.01,"inner-max":10,max:11,step:.01},{default:a(()=>[i(p(ae.value),1)]),_:1},8,["modelValue"]),e[22]||(e[22]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Kc"),o("div",{class:"text-caption"},"Goto Tollerance (arc-min)")],-1))]),o("div",We,[t(b,{modelValue:P.value,"onUpdate:modelValue":e[6]||(e[6]=s=>P.value=s),"show-value":"",min:-.2,"inner-min":.01,"inner-max":1,max:1.2,step:.01},{default:a(()=>[i(p(le.value),1)]),_:1},8,["modelValue"]),e[23]||(e[23]=o("div",{class:"column"},[o("div",{class:"text-h6"},"Ke"),o("div",{class:"text-caption"},"Expotential OP Smoothing")],-1))])]),e[24]||(e[24]=o("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[24]})]),_:1})]),o("div",Ze,[t(O,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:a(()=>[t(G),t(q,null,{default:a(()=>[t(v,null,{default:a(()=>[t(f,null,{default:a(()=>[i(p(B.value)+" Angular Velocity (degrees/s) vs Time (seconds)",1)]),_:1}),t(f,{caption:""},{default:a(()=>e[25]||(e[25]=[i("OP: Output Velocity, Kp: Proportion, Ki: Integral, Kd: Derivative, FF: Feed Forward",-1)])),_:1,__:[25]})]),_:1})]),_:1}),t(J,{data:ue.value,x1Type:"time"},null,8,["data"]),t(H,{label:`Advanced ${B.value} PID Settings`},{default:a(()=>[o("div",et,[o("div",tt,[t(b,{modelValue:C.value,"onUpdate:modelValue":e[7]||(e[7]=s=>C.value=s),"show-value":"",min:-.2,"inner-min":.01,"inner-max":2,max:2.2,step:.01},{default:a(()=>[i(p(ee.value),1)]),_:1},8,["modelValue"]),o("div",ot,[o("div",lt,[e[26]||(e[26]=i("Kp",-1)),o("sub",null,p(k.value),1)]),e[27]||(e[27]=o("div",{class:"text-caption"},"Proportional Gain",-1))])]),o("div",at,[t(b,{modelValue:Q.value,"onUpdate:modelValue":e[8]||(e[8]=s=>Q.value=s),"show-value":"",min:-.1,"inner-min":0,"inner-max":.5,max:.6,step:.01},{default:a(()=>[i(p(te.value),1)]),_:1},8,["modelValue"]),o("div",st,[o("div",it,[e[28]||(e[28]=i("Ki",-1)),o("sub",null,p(k.value),1)]),e[29]||(e[29]=o("div",{class:"text-caption"},"Integral Gain",-1))])]),o("div",nt,[t(b,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=s=>D.value=s),"show-value":"",min:-.2,"inner-min":.01,"inner-max":2,max:2.2,step:.01},{default:a(()=>[i(p(oe.value),1)]),_:1},8,["modelValue"]),o("div",ut,[o("div",dt,[e[30]||(e[30]=i("Kd",-1)),o("sub",null,p(k.value),1)]),e[31]||(e[31]=o("div",{class:"text-caption"},"Derivative Gain",-1))])])])]),_:1},8,["label"]),e[32]||(e[32]=o("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[32]})])])]),_:1})}}});export{Zt as default};
