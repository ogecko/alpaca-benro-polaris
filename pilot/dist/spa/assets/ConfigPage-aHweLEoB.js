import{Q as X}from"./QSpace-BN0aJBPV.js";import{d as H,c as F,q as K,B as T,E as z,H as g,F as m,J as s,O as f,I as e,R as Z,M as x,Q as I,Z as Y,L as v,X as a,N as d,a as O,w as G,z as tt,_ as et,$ as st}from"./index-D0PfnkpG.js";import{Q as c}from"./QInput-BmPm8Cyr.js";import{Q}from"./QCard-6DoyIm7v.js";import{Q as _}from"./QToggle-Bw93hT-T.js";import{Q as ot}from"./QPage-DDnpSOm6.js";import{u as lt}from"./use-quasar-BJ_974Js.js";import{u as J}from"./config-DgLwdXr6.js";import{u as W}from"./device-BmVq6k0z.js";import{_ as at,g as it}from"./LocationPicker.vue_vue_type_style_index_0_lang-DyaLFECN.js";import{_ as nt}from"./StatusBanners.vue_vue_type_script_setup_true_lang-BRv7l7Yp.js";import{a as U,Q as ct}from"./QItem-DWSf3WsE.js";import{Q as D}from"./QItemLabel-DtikKCSR.js";import{Q as rt}from"./QImg-DlpbjFWo.js";import{u as dt}from"./status-BAlaugUt.js";import{f as N}from"./scale-mzrGa2OM.js";import{_ as w}from"./MoveButton.vue_vue_type_script_setup_true_lang-Ci4vo5VO.js";import"./use-key-composition-Di3_QzSz.js";import"./use-dark-8KyFGCrv.js";import"./focus-manager-BJWzFvJg.js";import"./use-checkbox-Bv6dtl4F.js";import"./_commonjsHelpers-_d1bhYXs.js";import"./QBanner-Dj-BV9YE.js";import"./use-timeout-el27kvYe.js";import"./angles-DsQ2VyPl.js";class ut{intervalId=null;pollFn=null;fnName=null;intervalMs=1e4;constructor(){}startPolling(r,u=10,l){this.fnName=l||r.name||"[anonymous]",console.log(`Starting polling: ${this.fnName} every ${u}s`),this.pollFn=r,this.intervalMs=u*1e3,this.intervalId=window.setInterval(()=>{document.visibilityState==="visible"&&this.pollFn&&Promise.resolve(this.pollFn()).catch(y=>console.warn("Polling function threw:",y))},this.intervalMs)}stopPolling(){this.intervalId!==null&&(console.log(`Stop polling: ${this.fnName}`),clearInterval(this.intervalId),this.intervalId=null)}}const mt="/assets/abp-v2-motor-limits-b-BwHnQsEL.png",gt={class:"row"},pt={key:0,class:"col text-caption text-grey-6 q-pb-md"},_t={key:1,class:"col text-caption text-grey-6 q-pb-md"},ft={class:"row justify-center"},vt={class:"relative-position",style:{height:"300px",width:"300px"}},ht={class:"row q-col-gutter-lg items-center q-pt-md"},bt={class:"text-h6"},xt={key:0},yt={class:"row q-col-gutter-lg items-center q-pt-sm"},wt={class:"text-h6"},Mt={key:0},Pt={class:"row q-col-gutter-lg q-pb-md items-center q-pt-sm"},qt={class:"text-h6"},At={key:0},Ct=H({__name:"MotorLimits",setup(E){const r=W(),u=J(),l=dt(),y=F(()=>({modelValue:N(l.zetameas[2]??0,"deg",1)})),q=F(()=>({modelValue:N(l.zetameas[1]??0,"deg",1)})),h=F(()=>({modelValue:N(l.zetameas[0]??0,"deg",1)})),i=F(()=>(l.omegamin?.some(t=>t===0)??!1)||(l.omegamax?.some(t=>t===0)??!1));K(async()=>{r.restAPIConnected&&r.restAPIConnectedAt&&u.fetchedAt<r.restAPIConnectedAt&&await u.configFetch()});async function M(){console.log("Goto Park Position"),await r.alpacaPark(),await r.alpacaUnPark()}async function A(t){await r.apiAction("Polaris:MoveMotor",`{"axis":0,"rate":${t.isPressed?5:0}}`)}async function R(t){await r.apiAction("Polaris:MoveMotor",`{"axis":0,"rate":${t.isPressed?-5:0}}`)}async function V(t){await r.apiAction("Polaris:MoveMotor",`{"axis":1,"rate":${t.isPressed?5:0}}`)}async function L(t){await r.apiAction("Polaris:MoveMotor",`{"axis":1,"rate":${t.isPressed?-5:0}}`)}async function j(t){await r.apiAction("Polaris:MoveMotor",`{"axis":2,"rate":${t.isPressed?5:0}}`)}async function B(t){await r.apiAction("Polaris:MoveMotor",`{"axis":2,"rate":${t.isPressed?-5:0}}`)}function p(t,n,C){const P=u[t],k=typeof P,$=["string","number","boolean"].includes(k);return{label:n,suffix:C,modelValue:$?P:"","onUpdate:modelValue":b=>{if(b!==null&&$){u[t]=b;const S={[t]:b};o(S)}}}}const o=T(t=>u.configUpdate(t),5);return(t,n)=>(g(),z(Q,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:m(()=>[n[6]||(n[6]=s("div",{class:"text-h6"},"Motor Angle Limts",-1)),s("div",gt,[i.value?(g(),f("div",pt,[e(ct,null,{default:m(()=>[e(U,{avatar:""},{default:m(()=>[e(Z,{name:"mdi-alert",color:"negative",size:"lg"})]),_:1}),e(U,null,{default:m(()=>[e(D,null,{default:m(()=>n[1]||(n[1]=[x("Anti-windup Motor Angle Limit Reached",-1)])),_:1,__:[1]}),e(D,{class:"text-grey-6",caption:""},{default:m(()=>n[2]||(n[2]=[x("Use the buttons M1+, M1-, etc to move the mount back to safety. Alternitively issue a Park command. ",-1)])),_:1,__:[2]})]),_:1}),e(U,{side:""},{default:m(()=>[e(I,{label:"Park",icon:"mdi-parking",class:"fixedWidth",onClick:M})]),_:1})]),_:1})])):(g(),f("div",_t," To prevent cable windup, define minimum and maximum angle limits for each axis. Values beyond ±360° indicate the number of full rotations permitted in that direction. Axis M2 is also mechanically limited. "))]),s("div",ft,[s("div",vt,[e(rt,{src:mt,fit:"scale-down",onContextmenu:n[0]||(n[0]=Y(()=>{},["prevent"]))}),e(w,{activeColor:"positive",label:"M3+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:j,class:"absolute",style:{top:"2%",left:"47%"}}),e(w,{activeColor:"positive",label:"M3-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:B,class:"absolute",style:{top:"2%",left:"77%"}}),e(w,{activeColor:"positive",label:"M2+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:V,class:"absolute",style:{top:"43%",left:"38%"}}),e(w,{activeColor:"positive",label:"M2-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:L,class:"absolute",style:{top:"66%",left:"25%"}}),e(w,{activeColor:"positive",label:"M1+",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:A,class:"absolute",style:{top:"79%",left:"11%"}}),e(w,{activeColor:"positive",label:"M1-",opacity:1,size:"md",color:"white",icon:"",dense:"",onPush:R,class:"absolute",style:{top:"91%",left:"30%"}})])]),s("div",ht,[s("div",bt,[n[3]||(n[3]=x("M3 ",-1)),t.$q.screen.gt.xs?(g(),f("span",xt,"Axis")):v("",!0)]),e(c,a({class:"col-3"},p("z3_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamin[2]===0?"negative":void 0}),null,16,["bg-color"]),e(c,a({dense:"",class:"col-3",readonly:"",label:"Current"},y.value,{type:"text","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},p("z3_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamax[2]===0?"negative":void 0}),null,16,["bg-color"])]),s("div",yt,[s("div",wt,[n[4]||(n[4]=x("M2 ",-1)),t.$q.screen.gt.xs?(g(),f("span",Mt,"Axis")):v("",!0)]),e(c,a({class:"col-3"},p("z2_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamin[1]===0?"negative":void 0}),null,16,["bg-color"]),e(c,a({dense:"",class:"col-3",readonly:"",label:"Current"},q.value,{type:"text","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},p("z2_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamax[1]===0?"negative":void 0}),null,16,["bg-color"])]),s("div",Pt,[s("div",qt,[n[5]||(n[5]=x("M1 ",-1)),t.$q.screen.gt.xs?(g(),f("span",At,"Axis")):v("",!0)]),e(c,a({class:"col-3"},p("z1_min_limit","Min (-)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamin[0]===0?"negative":void 0}),null,16,["bg-color"]),e(c,a({dense:"",class:"col-3",readonly:"",label:"Current"},h.value,{type:"text","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},p("z1_max_limit","Max (+)","°"),{type:"number","input-class":"text-right",dense:"","bg-color":d(l).omegamax[0]===0?"negative":void 0}),null,16,["bg-color"])])]),_:1,__:[6]}))}}),kt={class:"row q-pb-sm q-col-gutter-md items-center"},$t={class:"col text-h6 q-ml-md"},St={key:0,class:"text-caption text-grey-6"},Ft={class:"q-gutter-md flex justify-end q-mr-md"},zt={class:"col-auto q-gutter-sm flex justify-end items-center"},It={class:"row q-col-gutter-sm items-stretch"},Qt={class:"col-12 col-md-6 col-lg-4 flex"},Rt={class:"row q-col-gutter-lg items-center"},Vt={class:"col-auto q-gutter-sm flex justify-end items-center"},Lt={class:"q-pt-md q-pb-md"},jt={class:"row q-col-gutter-lg q-pb-md"},Bt={class:"row q-col-gutter-lg"},Ut={class:"col-12 col-md-6 col-lg-4 flex"},Nt={class:"col-12 col-md-6 col-lg-4 flex"},Tt={class:"row q-col-gutter-lg items-center"},Et={class:"col-auto q-gutter-sm flex justify-end"},Ot={key:0,class:"q-gutter-y-sm"},Gt={class:"row"},Dt={class:"row"},Ht={class:"row"},Kt={class:"row"},Jt={class:"row"},Wt={key:0,class:"row q-pl-md q-gutter-xl"},Xt={class:"col-12 col-md-6 col-lg-4 flex"},Zt={class:"q-gutter-y-sm"},Yt={class:"row"},te={class:"row q-pt-md q-pl-md q-col-gutter-lg"},Ae=H({__name:"ConfigPage",setup(E){const r=lt(),u=W(),l=J(),y=new ut,q=[o=>o>0||"Rate must be greater than zero",o=>o<9||"Rate must be less than 9.0"],h=O(l.max_slew_rate!=0);G(h,async o=>{const t=o?{max_slew_rate:8.5,max_accel_rate:3}:{max_slew_rate:0,max_accel_rate:0};await l.configUpdate(t)}),G(()=>l.max_slew_rate,o=>{h.value=o!=0}),K(async()=>{u.restAPIConnected&&u.restAPIConnectedAt&&l.fetchedAt<u.restAPIConnectedAt&&await l.configFetch(),y.startPolling(()=>{l.configFetch()},10,"configFetch")}),tt(()=>{y.stopPolling()});function i(o,t,n){const C=l[o],P=typeof C,k=["string","number","boolean"].includes(P),$=P==="boolean";return{label:t,...n?{suffix:n}:{},class:{taflash:M.value.has(o)},modelValue:k?C:"","onUpdate:modelValue":b=>{if(b!==null&&k){l[o]=b;const S={[o]:b};$?p(S):B(S)}}}}const M=O(new Set);function A(o){o.forEach(t=>M.value.add(t)),setTimeout(()=>{o.forEach(t=>M.value.delete(t))},600)}async function R(){const o=await it();o.success&&(p(o.data),A(Object.keys(o.data)))}function V(o){o.success&&(p(o.data),A(Object.keys(o.data)))}async function L(){const o=await l.configSave();r.notify({message:`Configuration save ${o?"successful":"unsucessful"}.`,type:o?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}async function j(){const o=await l.configRestore();r.notify({message:`Configuration restore ${o?"successful":"unsucessful"}.`,type:o?"positive":"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]})}const B=T(o=>l.configUpdate(o),500),p=T(o=>l.configUpdate(o),5);return(o,t)=>(g(),z(ot,{class:"q-pa-sm"},{default:m(()=>[e(nt),s("div",null,[s("div",kt,[s("div",$t,[t[1]||(t[1]=x(" Alpaca Driver Settings ",-1)),d(r).screen.gt.xs?(g(),f("div",St," Settings take effect instantly. Click Save to persist after restart, or Restore to revert to Config.toml defaults. ")):v("",!0)]),e(X),s("div",Ft,[s("div",zt,[e(I,{rounded:"",color:"grey-9",label:"Save",onClick:L,disable:d(l).isSaving,loading:d(l).isSaving},null,8,["disable","loading"]),e(I,{rounded:"",color:"grey-9",label:"Restore",onClick:j,disable:d(l).isRestoring,loading:d(l).isRestoring},null,8,["disable","loading"])])])]),s("div",It,[s("div",Qt,[e(Q,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:m(()=>[t[3]||(t[3]=s("div",{class:"text-h6"},"Observing Site Information",-1)),s("div",Rt,[t[2]||(t[2]=s("div",{class:"col text-caption text-grey-6 q-pb-md"}," Latitude and longitude are essential for accurate tracking. Other settings follow the ASCOM Alpaca standard and are optional. ",-1)),s("div",Vt,[e(I,{outline:"",icon:"mdi-crosshairs-gps",color:"grey-5",label:"Locate",onClick:R})])]),s("div",Lt,[e(at,{lat:d(l).site_latitude,lon:d(l).site_longitude,onLocationInfo:V},null,8,["lat","lon"])]),s("div",jt,[e(c,a({class:"col-3"},i("site_latitude","Latitude","°"),{type:"number","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},i("site_longitude","Longitude","°"),{type:"number","input-class":"text-right"}),null,16),e(c,a({class:"col-6"},i("location","Location")),null,16)]),s("div",Bt,[e(c,a({class:"col-3"},i("site_elevation","Elevation","m"),{type:"number","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},i("site_pressure","Pressure","hPa"),{type:"number","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},i("focal_length","Focal Length","mm"),{type:"number","input-class":"text-right"}),null,16),e(c,a({class:"col-3"},i("focal_ratio","Focal Ratio","f-stop"),{type:"number","input-class":"text-right"}),null,16)])]),_:1,__:[3]})]),s("div",Ut,[e(Ct)]),s("div",Nt,[e(Q,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:m(()=>[t[7]||(t[7]=s("div",{class:"text-h6"},"Advanced Control Features",-1)),s("div",Tt,[t[4]||(t[4]=s("div",{class:"col text-caption text-grey-6 q-pb-md"}," Use Advanced Position Control to override the Benro Polaris default behaviour. Toggle individual features below to enable advanced slewing, goto, tracking, guiding and rotator support. ",-1)),s("div",Et,[e(_,a({class:"col"},i("advanced_control","Enable")),null,16)])]),d(l).advanced_control?(g(),f("div",Ot,[s("div",Gt,[e(_,a({class:"col-6"},i("advanced_kf","Kalman Filtering")),null,16),e(_,a({class:"col-6"},i("advanced_rotator","Alpaca Rotator")),null,16)]),s("div",Dt,[e(_,a({class:"col-6"},i("advanced_slewing","Slewing")),null,16),e(_,a({class:"col-6"},i("advanced_goto","Advanced Goto")),null,16)]),s("div",Ht,[e(_,a({class:"col-6"},i("advanced_tracking","Tracking")),null,16),e(_,a({class:"col-6"},i("advanced_alignment","Multi-Point Alignment")),null,16)]),s("div",Kt,[e(_,a({class:"col-6"},i("advanced_guiding","Pulse Guiding")),null,16)]),t[6]||(t[6]=s("div",{class:"text-caption text-grey-6 q-pt-md"},"Restrict the motor controller’s peak slew rate and how quickly it will accelerate.",-1)),s("div",Jt,[e(_,{class:"col-6",modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=n=>h.value=n)},{default:m(()=>t[5]||(t[5]=[x("Restrict Slew and Acceleration Rates",-1)])),_:1,__:[5]},8,["modelValue"])]),h.value?(g(),f("div",Wt,[e(c,a({class:"col-4"},i("max_slew_rate","Max Slew Rate","°/s"),{type:"number",rules:q,"input-class":"text-right"}),null,16),e(c,a({class:"col-4"},i("max_accel_rate","Max Acceleration Rate","°/s²"),{type:"number",rules:q,"input-class":"text-right"}),null,16)])):v("",!0)])):v("",!0)]),_:1,__:[7]})]),s("div",Xt,[e(Q,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:m(()=>[t[8]||(t[8]=s("div",{class:"text-h6"},"Standard Control Features",-1)),t[9]||(t[9]=s("div",{class:"row"},[s("div",{class:"col-12 text-caption text-grey-6 q-pb-md"}," Aiming Adjustment improves the standard Benro Polaris Goto performance, by correcting any aiming bias, and by forward calculating co-ordinates into the future. ")],-1)),s("div",Zt,[s("div",Yt,[e(_,et(st(i("aiming_adjustment_enabled","Enable Aiming Adjustment"))),null,16)]),s("div",te,[d(l).aiming_adjustment_enabled?(g(),z(c,a({key:0,class:"col-4"},i("aim_max_error_correction","Max Bias Correction","°"),{type:"number","input-class":"text-right"}),null,16)):v("",!0),d(l).aiming_adjustment_enabled?(g(),z(c,a({key:1,class:"col-4"},i("aiming_adjustment_time","Future offset Time","s"),{type:"number","input-class":"text-right"}),null,16)):v("",!0),e(c,a({class:"col-4"},i("tracking_settle_time","Tracking Settle Time","s"),{type:"number","input-class":"text-right"}),null,16)])])]),_:1,__:[8,9]})])])])]),_:1}))}});export{Ae as default};
