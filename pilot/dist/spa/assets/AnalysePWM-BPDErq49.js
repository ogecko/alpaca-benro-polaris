import{Q as F}from"./QSpace-C1Va0Z9s.js";import{Q as X}from"./QBtnToggle-CF7_zS8g.js";import{Q as m,a as n}from"./QItem-DElyg9VS.js";import{Q as l}from"./QItemLabel-CK7Qz7ML.js";import{Q as k}from"./QList-bDtWInJC.js";import{Q as A}from"./QCard-BMtrk8fE.js";import{Q as M}from"./QKnob-DfRmSXZW.js";import{Q as H}from"./QPage-BG9fphcy.js";import{u as L}from"./use-timeout-AtCFx9xI.js";import{_ as j}from"./StatusBanners.vue_vue_type_script_setup_true_lang-BTDZ67GE.js";import{C}from"./ChartXY-CfGTB2CN.js";import{u as E}from"./stream-CN5GCWOz.js";import{u as G}from"./device-Cat4i7bx.js";import{_ as $}from"./MoveButton.vue_vue_type_script_setup_true_lang-i7TaybYe.js";import{d as J,a as p,c as P,q as Y,z as Z,w as ee,E as te,F as t,I as e,J as r,N as a,G as oe,P as c,H as ae}from"./index-Bd6lk8z5.js";import"./QBtnGroup-BD5jDpg7.js";import"./use-dark-hcR8qNVl.js";import"./QCircularProgress-C5KZe2nX.js";import"./format-BvkBI9bc.js";import"./TouchPan-D7bNYC77.js";import"./touch-BjYP5sR0.js";import"./selection-BLtXCk7y.js";import"./status-EbeAbA17.js";import"./index-DaEgsOZv.js";import"./scale-BUHoRS_z.js";import"./angles-CM-dTGcw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"row q-pb-sm q-col-gutter-md items-center"},se={class:"row q-col-gutter-sm items-stretch"},ne={class:"col-12 flex"},ie={class:"row"},ue={class:"col-md-6"},re={class:"col-md-6 q-pt-sm"},de={class:"q-gutter-ax"},me={class:"col-12 col-lg-6 flex"},fe={class:"col-12 col-lg-6 flex"},Ke=J({__name:"AnalysePWM",setup(pe){const f=E(),y=G(),{registerTimeout:Q,removeTimeout:W}=L(),i=p(0),v=p(1),w=p(.5),g=p(2),V=p(1),x=p(1),_=P(()=>`M${i.value+1}`),T=P(()=>g.value-V.value),U=P(()=>(f.topics?.kf??[]).map(K)),O=P(()=>(f.topics?.kf??[]).map(R));async function B(s){x.value=1,s.isPressed?await q():await D()}async function N(s){x.value=-1,s.isPressed?await q():await D()}async function q(){await S()}async function D(){await y.apiAction("Polaris:MoveMotor",`{"axis":${i.value},"rate":0}`),W()}async function S(){Q(()=>{I()},w.value*1e3),await y.apiAction("Polaris:MoveMotor",`{"axis":${i.value},"rate":${x.value*g.value}, "unit":"RAW"}`)}async function I(){Q(()=>{S()},v.value*1e3-w.value*1e3),await y.apiAction("Polaris:MoveMotor",`{"axis":${i.value},"rate":${x.value*T.value}, "unit":"RAW"}`)}function K(s){const o=new Date(s.ts),d=s.data,u=`M${i.value+1}`,h=d.θ_meas[i.value]??0,b=d.θ_state[i.value]??0;return{x1:o,[u]:h,PV:b}}function R(s){const o=new Date(s.ts),d=s.data,u=`M${i.value+1}`,h=d.ω_meas[i.value]??0,b=d.ω_state[i.value]??0,z=d.ω_ref[i.value]??0;return{x1:o,[u]:h,PV:b,SP:z}}return Y(()=>{f.subscribe("kf")}),Z(()=>{f.unsubscribe("kf")}),ee(()=>y.isVisible,s=>{s?f.subscribe("kf"):f.unsubscribe("kf")}),(s,o)=>{const d=oe("q-markdown");return ae(),te(H,{class:"q-pa-sm dark-page"},{default:t(()=>[e(j),r("div",le,[o[5]||(o[5]=r("div",{class:"col text-h6 q-ml-md"},[a(" Alpaca Driver Performance Analysis "),r("div",{class:"text-caption text-grey-6"}," Use these pages to perform tests and analyse the performance of your Benro Polaris. ")],-1)),e(F)]),r("div",se,[r("div",ne,[e(A,{flat:"",bordered:"",class:"col q-pa-md"},{default:t(()=>[r("div",ie,[r("div",ue,[e(d,{"no-mark":!1},{default:t(()=>o[6]||(o[6]=[a(`
  # Motor PWM Testing
  To achieve the precise, low-speed motion required for sidereal tracking, we control the motors using Pulse Width Modulation (PWM). By adjusting the period and pulse width, we can finely tune motor behavior to maintain consistent tracking rates.

  This page allows you to evaluate the speed performance of each motor across a range of PWM configurations, helping you identify optimal settings for smooth, accurate motion.
  `,-1)])),_:1,__:[6]})]),r("div",re,[e(k,{style:{"max-width":"800px"}},{default:t(()=>[e(m,null,{default:t(()=>[e(n,{side:"",top:""},{default:t(()=>[e(X,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=u=>i.value=u),push:"",rounded:"",glossy:"","toggle-color":"primary",options:[{label:"M1",value:0},{label:"M2",value:1},{label:"M3",value:2}]},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>o[7]||(o[7]=[a(" Choosen Motor Axis",-1)])),_:1,__:[7]}),e(l,{caption:""},{default:t(()=>o[8]||(o[8]=[a(" Select the motor axis you'd like to analyse and tune. Motor 1 Azimuth; Motor 2 Altitude; Motor 3 Astro head. Keep in mind: when Motor 3 (Astro Head) is rotated, the orientation of Motor 1 and Motor 2 no longer corresponds directly to Azimuth and Altitude. ",-1)])),_:1,__:[8]})]),_:1})]),_:1}),e(m,{"inset-level":1},{default:t(()=>[e(n,{top:"",side:""},{default:t(()=>[r("div",de,[e($,{activeColor:"positive",icon:"mdi-minus-circle",onPush:N}),e($,{activeColor:"positive",icon:"mdi-plus-circle",onPush:B})])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>[a(" Test movement of "+c(_.value),1)]),_:1}),e(l,{caption:""},{default:t(()=>o[9]||(o[9]=[a(" Use the following action buttons to move the motor and monitor how well the motor speed is controlled. ",-1)])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})])])]),_:1})]),r("div",me,[e(A,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:t(()=>[e(k,null,{default:t(()=>[e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[e(l,null,{default:t(()=>o[10]||(o[10]=[a("Angular Position (degrees) vs Time (seconds)",-1)])),_:1,__:[10]}),e(l,{caption:""},{default:t(()=>o[11]||(o[11]=[a("M1-3: Measured Position, PV: Present Value Position ",-1)])),_:1,__:[11]})]),_:1})]),_:1}),e(C,{data:U.value,x1Type:"time"},null,8,["data"]),e(m,null,{default:t(()=>[e(n,{side:"",top:""},{default:t(()=>[e(M,{modelValue:g.value,"onUpdate:modelValue":o[1]||(o[1]=u=>g.value=u),"show-value":"",min:0,"inner-min":1,"inner-max":5,max:6,step:1},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>[a(" On Duty Slew Rate for "+c(_.value),1)]),_:1}),e(l,{caption:""},{default:t(()=>o[12]||(o[12]=[a(" The active duty slew rate based on the fine motion rates used in the Polaris app. ",-1)])),_:1,__:[12]})]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(n,{side:"",top:""},{default:t(()=>[e(M,{modelValue:V.value,"onUpdate:modelValue":o[2]||(o[2]=u=>V.value=u),"show-value":"",min:0,"inner-min":1,"inner-max":2,max:3,step:1},{default:t(()=>[a(c(T.value),1)]),_:1},8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>[a(" Off Duty Slew Rate for "+c(_.value),1)]),_:1}),e(l,{caption:""},{default:t(()=>o[13]||(o[13]=[a(" The inactive duty slew rate either 1 or 2 below the active duty rate. ",-1)])),_:1,__:[13]})]),_:1})]),_:1})]),_:1}),o[14]||(o[14]=r("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[14]})]),r("div",fe,[e(A,{flat:"",bordered:"",class:"q-pa-md full-width"},{default:t(()=>[e(k,null,{default:t(()=>[e(m,null,{default:t(()=>[e(n,null,{default:t(()=>[e(l,null,{default:t(()=>o[15]||(o[15]=[a("Angular Velocity (degrees/s) vs Time (seconds)",-1)])),_:1,__:[15]}),e(l,{caption:""},{default:t(()=>o[16]||(o[16]=[a("M1-3: Measured Velocity, PV: Present Value Velocity. SP: Setpoint Velocity",-1)])),_:1,__:[16]})]),_:1})]),_:1}),e(C,{data:O.value,x1Type:"time"},null,8,["data"]),e(m,null,{default:t(()=>[e(n,{side:"",top:""},{default:t(()=>[e(M,{modelValue:w.value,"onUpdate:modelValue":o[3]||(o[3]=u=>w.value=u),"show-value":"",min:-1,"inner-min":.01,"inner-max":v.value-.01,max:v.value+1,step:.01},null,8,["modelValue","inner-max","max"])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>[a(" On Duty Pulse width (s) for "+c(_.value),1)]),_:1}),e(l,{caption:""},{default:t(()=>o[17]||(o[17]=[a(" This is the time a signal remains at the higher level during one complete cycle. ",-1)])),_:1,__:[17]})]),_:1})]),_:1}),e(m,null,{default:t(()=>[e(n,{side:"",top:""},{default:t(()=>[e(M,{modelValue:v.value,"onUpdate:modelValue":o[4]||(o[4]=u=>v.value=u),"show-value":"",min:-1,"inner-min":.1,"inner-max":5,max:6,step:.01},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(l,null,{default:t(()=>[a(" Control Cycle Period (s) for "+c(_.value),1)]),_:1}),e(l,{caption:""},{default:t(()=>o[18]||(o[18]=[a(" The total time for one complete ON–OFF cycle of the control signal. ",-1)])),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1})}}});export{Ke as default};
