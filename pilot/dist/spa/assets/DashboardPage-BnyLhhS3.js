import{Q as _}from"./QTooltip-lgoYhUPf.js";import{a1 as J,az as W,d as X,a as T,c as A,q as Y,D as Z,E as k,F as n,H as m,I as l,J as z,K as L,Q as w,N as d,M as c,s as C,R as ee,O as Q,T as te,S as ae}from"./index-T-4rhSG0.js";import{Q as oe}from"./QBtnGroup-Pn0tSUue.js";import{Q as P}from"./QItemLabel-ifJqzwUZ.js";import{Q as S,a as $}from"./QItem-Bo1j1REv.js";import{Q as le}from"./QList-ryp9TBwh.js";import{Q as ne}from"./QBtnDropdown-Bto6oDW_.js";import{Q as se}from"./QSpace-Cr2NI7NR.js";import{Q as ie}from"./QPage-yE0UZLrl.js";import{g as re,d as ce}from"./position-engine-DWKJInj3.js";import{u as ue}from"./use-quasar-Jg3nhEJs.js";import{u as pe}from"./device-_czZEvqZ.js";import{u as de}from"./status-8gs9HN__.js";import{a as q,S as me}from"./SpinnerSpeed-lNbWm3rK.js";import{_ as fe}from"./StatusBanners.vue_vue_type_script_setup_true_lang-Dg8ZqQW9.js";import{_ as ge}from"./PIDStatus.vue_vue_type_script_setup_true_lang-ixIwK7mY.js";import{f as b}from"./angles-gRV9FYwb.js";import"./use-model-toggle-CahUEy8D.js";import"./focus-manager-DRvvFMAt.js";import"./use-timeout-Camtw4_Z.js";import"./scroll-DXdCiYO0.js";import"./selection-DDbEVbh9.js";import"./use-dark-DE-NN0Ly.js";import"./QMenu-x4BkNopV.js";import"./QInput-CP0ZIvXI.js";import"./use-key-composition-BhbgGY22.js";import"./index-DaEgsOZv.js";import"./scale-MATHP_kN.js";import"./MoveButton.vue_vue_type_script_setup_true_lang-CRIBRQ26.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-C04shoOv.js";function E(i){if(i===!1)return 0;if(i===!0||i===void 0)return 1;const r=parseInt(i,10);return isNaN(r)?0:r}const R=J({name:"close-popup",beforeMount(i,{value:r}){const u={depth:E(r),handler(o){u.depth!==0&&setTimeout(()=>{const a=re(i);a!==void 0&&ce(a,o,u.depth)})},handlerKey(o){W(o,13)===!0&&u.handler(o)}};i.__qclosepopup=u,i.addEventListener("click",u.handler),i.addEventListener("keyup",u.handlerKey)},updated(i,{value:r,oldValue:u}){r!==u&&(i.__qclosepopup.depth=E(r))},beforeUnmount(i){const r=i.__qclosepopup;i.removeEventListener("click",r.handler),i.removeEventListener("keyup",r.handlerKey),delete i.__qclosepopup}}),ve={class:"row q-pa-xs items-center q-col-gutter-sm"},_e={class:"q-pb-sm"},ke={class:"q-gutter-md"},be={class:"row"},we={key:0,class:"col-12 col-md-6 col-lg-4 col-xl-3 row justify-center"},Ze=X({__name:"DashboardPage",setup(i){const r=ue(),u=Z(),o=pe(),a=de(),y=T(!1),D=T(!0),H=A(()=>y.value?[{label:"Right Ascension",pv:a.rightascension,sp:a.deltarefRAhrs,domain:"ra_24"},{label:"Declination",pv:a.declination,sp:a.deltaref[1],domain:"dec_180"},{label:"Position Angle",pv:a.positionangle,sp:a.deltaref[2],domain:"pa_360"}]:[{label:"Azimuth",pv:a.azimuth,sp:a.alpharef[0],domain:"az_360"},{label:"Altitude",pv:a.altitude,sp:a.alpharef[1],domain:"alt_90"},{label:"Roll",pv:a.roll,sp:a.alpharef[2],domain:"roll_180"}]),N=A(()=>{if(a.pidmode!="IDLE")return!1;const e=b(a.rightascension,a.deltarefRAhrs),t=b(a.declination,a.deltaref[1]??0),s=b(a.positionangle,a.deltaref[2]??0),p=b(a.azimuth,a.alpharef[0]??0),I=b(a.altitude,a.alpharef[1]??0),M=b(a.roll,a.alpharef[2]??0);return e*e+t*t+s*s+p*p+I*I+M*M>1}),f=A(()=>(r.screen.lt.sm,"md")),g=A(()=>!!r.screen.lt.md);Y(async()=>{const e=Array.isArray(u.query.api)?u.query.api[0]:u.query.api;e&&(o.restAPIPort=parseInt(e)),!o.alpacaHost&&window.location.hostname&&(o.alpacaHost=window.location.hostname),!o.restAPIPort&&window.location.port&&(o.restAPIPort=parseInt(window.location.port)),o.alpacaHost&&o.restAPIPort&&await o.connectRestAPI()});function v(e){return a.atpark&&e!="Park"?(r.notify({message:`Cannot ${e} while mount is parked. Unpark Mount.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):a.pidmode=="LIMIT"?(r.notify({message:`Cannot ${e} while past motor angle limit. Reset the Limit.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):!1}async function B(){const e=await o.alpacaResetSP();console.log(e)}async function K(){if(v("toggle tracking"))return;const e=a.tracking?await o.alpacaTracking(!1):await o.alpacaTracking(!0);console.log(e)}async function h(e){const t=await o.alpacaTrackingRate(e);console.log(t)}async function F(){if(v("find Home"))return;const e=await o.alpacaFindHome();console.log(e)}async function O(){if(v("Park"))return;const e=a.atpark?await o.alpacaUnPark():await o.alpacaPark();console.log(e)}async function V(){if(v("abort"))return;D.value=!1,setTimeout(()=>{D.value=!0},200);const e=await o.alpacaAbortSlew();console.log(e)}async function G(e){if(!v("slew"))if(e.label=="Azimuth"){const t=e.angle,s=a.alpharef[1]??0,p=await o.alpacaSlewToAltAz(s,t);console.log(`Change ${e.label} angle to ${e.angle}`,p)}else if(e.label=="Altitude"){const t=a.alpharef[0]??0,s=e.angle,p=await o.alpacaSlewToAltAz(s,t);console.log(`Change ${e.label} angle to ${e.angle}`,p)}else if(e.label=="Roll"){const t=await o.alpacaMoveMechanical(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,t)}else if(e.label=="Right Ascension"){const t=e.angle,s=a.deltaref[1]??0,p=await o.alpacaSlewToCoord(t,s);console.log(`Change ${e.label} angle to ${e.angle}`,p)}else if(e.label=="Declination"){const t=a.deltarefRAhrs??0,s=e.angle,p=await o.alpacaSlewToCoord(t,s);console.log(`Change ${e.label} angle to ${e.angle}`,p)}else if(e.label=="Position Angle"){const t=await o.alpacaMoveAbsolute(e.angle);console.log(`Change ${e.label} angle to ${e.angle}`,t)}else console.log(`Click ${e.label} angle: ${e.angle}, offset: ${e.radialOffset}`)}async function U(e){if(v("slew"))return;const t=e.az??a.alpharef[0]??0,s=e.alt??a.alpharef[1]??0;e.roll!==void 0&&await o.alpacaMoveMechanical(e.roll),(e.az!==void 0||e.alt!==void 0)&&await o.alpacaSlewToAltAz(s,t),console.log("Fab Angle:",e)}const x={Azimuth:0,Altitude:1,Roll:2,"Right Ascension":3,Declination:4,"Position Angle":5};async function j(e){if(console.log("ClickMove ",e.label,e.rateScale),!Object.keys(x).includes(e.label))return;const t=x[e.label]??-1,s=t!=3?e.rateScale/200*9:e.rateScale/12*9;t>=0&&t<=5&&await o.apiAction("Polaris:MoveAxis",`{"axis":${t},"rate":${s}}`)}return(e,t)=>(m(),k(ie,{class:"q-pa-sm"},{default:n(()=>[l(fe),z("div",ve,[z("div",_e,[z("div",ke,[l(oe,null,{default:n(()=>[l(w,{icon:"mdi-telescope",glossy:"",dense:g.value,size:f.value,color:"secondary",push:"",outline:!y.value,onClick:t[0]||(t[0]=s=>y.value=!y.value)},{default:n(()=>[l(_,null,{default:n(()=>t[5]||(t[5]=[d("Switch between Equatorial and Az/Alt Co-ordinates.",-1)])),_:1,__:[5]})]),_:1},8,["dense","size","outline"]),N.value?(m(),k(w,{key:0,icon:"mdi-format-horizontal-align-center",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:"",onClick:B},{default:n(()=>[l(_,null,{default:n(()=>t[6]||(t[6]=[d("Reset all setpoints to their current values.",-1)])),_:1,__:[6]})]),_:1},8,["dense","size"])):L("",!0),l(w,{icon:"mdi-home",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:c(a).pidmode!="HOMING",onClick:F},{default:n(()=>[l(_,null,{default:n(()=>t[7]||(t[7]=[d("Return the mount to its Home position",-1)])),_:1,__:[7]})]),_:1},8,["dense","size","outline"]),l(w,{icon:"mdi-parking",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:c(a).pidmode!="PARKING",onClick:O},{default:n(()=>[l(_,null,{default:n(()=>t[8]||(t[8]=[d("Return the mount to its Park position.",-1)])),_:1,__:[8]})]),_:1},8,["dense","size","outline"]),l(w,{icon:"mdi-stop",glossy:"",dense:g.value,size:f.value,color:"secondary",outline:D.value,onClick:V},{default:n(()=>[l(_,null,{default:n(()=>t[9]||(t[9]=[d("Stop all motion of the mount.",-1)])),_:1,__:[9]})]),_:1},8,["dense","size","outline"])]),_:1}),l(ne,{dense:g.value,glossy:"",size:f.value,color:"secondary",split:"",outline:!c(a).tracking,onClick:K},{label:n(()=>[l(ee,{name:"mdi-star-shooting-outline"}),l(_,null,{default:n(()=>t[10]||(t[10]=[d("Toggle tracking on and off.",-1)])),_:1,__:[10]})]),default:n(()=>[l(le,{dense:""},{default:n(()=>[C((m(),k(S,{clickable:"",active:c(a).trackingrate==0,"active-class":"bg-secondary text-white",onClick:t[1]||(t[1]=s=>h(0))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>t[11]||(t[11]=[d("Sidereal",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),k(S,{clickable:"",active:c(a).trackingrate==1,"active-class":"bg-secondary text-white",onClick:t[2]||(t[2]=s=>h(1))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>t[12]||(t[12]=[d("Lunar",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),k(S,{clickable:"",active:c(a).trackingrate==2,"active-class":"bg-secondary text-white",onClick:t[3]||(t[3]=s=>h(2))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>t[13]||(t[13]=[d("Solar",-1)])),_:1,__:[13]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),k(S,{clickable:"",active:c(a).trackingrate==3,"active-class":"bg-secondary text-white",onClick:t[4]||(t[4]=s=>h(3))},{default:n(()=>[l($,null,{default:n(()=>[l(P,null,{default:n(()=>t[14]||(t[14]=[d("Custom",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["active"])),[[R]])]),_:1})]),_:1},8,["dense","size","outline"])])]),l(se),l(ge)]),z("div",be,[(m(!0),Q(ae,null,te(H.value,(s,p)=>(m(),Q("div",{key:p,class:"col-12 col-md-6 col-lg-4 col-xl-3"},[l(me,{label:s.label,pv:s.pv,sp:s.sp,lst:c(a).siderealtime,domain:s.domain,onClickScale:G,onClickFabAngle:U,onClickMove:j},null,8,["label","pv","sp","lst","domain"])]))),128)),c(a).pidmode!="PARK"?(m(),Q("div",we,[l(q,{class:"q-pa-sm",speed:c(a).motorref[0],position:c(a).zetameas[0],label:"M1"},null,8,["speed","position"]),l(q,{class:"q-pa-sm",speed:c(a).motorref[1],position:c(a).zetameas[1],label:"M2"},null,8,["speed","position"]),l(q,{class:"q-pa-sm",speed:c(a).motorref[2],position:c(a).zetameas[2],label:"M3"},null,8,["speed","position"])])):L("",!0)])]),_:1}))}});export{Ze as default};
