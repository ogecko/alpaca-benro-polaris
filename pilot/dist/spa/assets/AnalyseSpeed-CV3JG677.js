import{Q as O}from"./QSpace-Cbn5n1AE.js";import{Q as Y}from"./QBtnToggle-CW8gmeeA.js";import{Q as p,a as d}from"./QItem-BtFXUANw.js";import{Q as m}from"./QItemLabel-DruX3LLc.js";import{d as W,a as C,c as g,w as V,q as Z,z as tt,E as S,F as s,I as e,J as i,N as n,G as et,K as $,M as A,Q as k,P as x,H as P}from"./index-CZ03DXjz.js";import{Q as T}from"./QList-DJgI2ntr.js";import{Q as y}from"./QCard-j0TR8eB-.js";import{Q as st}from"./QTable-DE318B_A.js";import{Q as at}from"./QPage-E42FKURz.js";import{_ as ot}from"./StatusBanners.vue_vue_type_script_setup_true_lang-DhoqC0Bj.js";import{u as lt}from"./use-quasar-CmNHKJzh.js";import{C as M}from"./ChartXY-BFIiau9t.js";import{u as nt}from"./stream-Dwuq1MzQ.js";import{u as rt,s as it}from"./device-BMhOYHwV.js";import{u as ut}from"./status-D38DFJ6c.js";import"./QBtnGroup-CXtSZjc-.js";import"./use-dark-CEgltGwQ.js";import"./QSeparator-CfANHPhB.js";import"./QMarkupTable-CPOyzDiO.js";import"./QSelect-pEw8DlSn.js";import"./use-key-composition-CW69J13u.js";import"./focus-manager-DZlw9dCO.js";import"./QChip-G3G2U38g.js";import"./QMenu-DhMn_ZMz.js";import"./position-engine-c61Wc2kP.js";import"./selection-D2W554fp.js";import"./use-model-toggle-bobRI_2Q.js";import"./use-timeout-BXG4K7JF.js";import"./use-prevent-scroll-CIi6_vxZ.js";import"./rtl-DFPa-2ov.js";import"./format-BvkBI9bc.js";import"./QCheckbox-CzRXqYvI.js";import"./use-checkbox-Di9sDxoK.js";import"./index-DaEgsOZv.js";import"./scale-BUHoRS_z.js";import"./angles-CM-dTGcw.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const dt={class:"row q-pb-sm q-col-gutter-md items-center"},ct={class:"row q-col-gutter-sm items-stretch"},mt={class:"col-12 flex"},pt={class:"row"},ft={class:"col-md-6"},_t={class:"col-md-6 q-pt-sm"},vt={class:"col-12 flex"},bt={class:"q-pa-md"},gt={class:"col-12 col-md-6 flex"},xt={class:"col-12 col-md-6 flex"},oe=W({__name:"AnalyseSpeed",setup(yt){const u=nt(),b=rt(),h=ut(),q=lt(),c=C([]),o=C(0),f=g(()=>`M${o.value+1}`),D=g(()=>(u.topics?.kf??[]).map(N)),I=g(()=>(u.topics?.kf??[]).map(B)),Q=g(()=>{const t=(u.topics?.cm??[]).map(R).filter(l=>l.axis==o.value),r=new Map;for(const l of t)r.set(l.name,l);return Array.from(r.values())});V(o,()=>c.value=[]);function N(a){const t=new Date(a.ts),r=a.data,l=`M${o.value+1}`,_=r.θ_meas[o.value]??0,v=r.θ_state[o.value]??0;return{x1:t,[l]:_,PV:v}}function B(a){const t=new Date(a.ts),r=a.data,l=`M${o.value+1}`,_=r.ω_meas[o.value]??0,v=r.ω_state[o.value]??0,w=r.ω_ref[o.value]??0;return{x1:t,[l]:_,PV:v,SP:w}}function R(a){const t=a.data,r=t.name??"",l=t.axis??0,_=t.raw??0,v=t.ascom??0,w=t.dps??0,F=t.test_result??"",G=t.test_change??"",H=t.test_stdev??"",J=t.test_status??"";return{name:r,axis:l,raw:_,ascom:v,dps:w,test_result:F,test_change:G,test_stdev:H,test_status:J}}Z(()=>{u.subscribe("cm"),u.subscribe("kf")}),tt(()=>{u.unsubscribe("cm"),u.unsubscribe("kf")}),V(()=>b.isVisible,a=>{a?u.subscribe("cm"):u.unsubscribe("cm"),a?u.subscribe("kf"):u.unsubscribe("kf")});async function U(){console.log("stop test"),await b.apiAction("Polaris:SpeedTestStop",`{"axis": ${o.value}}`)}function L(){const a=c.value.length,t=a==0?"ALL":`${a}`;q.notify({message:`Are you sure you want to test motor ${f.value} with ${t} speed calibration tests?`,color:"warning",position:"top",timeout:5e3,actions:[{label:"Confirm",icon:"mdi-check",color:"yellow",handler:()=>{j()}},{label:"Cancel",icon:"mdi-close",color:"white",handler:()=>{}}]})}async function j(){console.log("start test");const a=c.value.filter(t=>t.axis==o.value).map(t=>`"${t.name}"`).join(",");await b.apiAction("Polaris:SpeedTestStart",`{"axis": ${o.value}, "testNames": [${a}]}`),await it(3e3)}async function E(){const a=c.value.filter(t=>t.axis==o.value).map(t=>`"${t.name}"`).join(",");await b.apiAction("Polaris:SpeedTestApproval",`{"axis": ${o.value}, "testNames": [${a}]}`)}const K=[{name:"name",required:!0,label:"Test Case",align:"left",field:a=>a.name,format:a=>`${a}`,sortable:!0},{name:"raw",align:"center",label:"Raw Command",field:"raw",sortable:!0},{name:"dps",label:"Baseline (°/s)",field:"dps",sortable:!0},{name:"testdps",label:"Test Result (°/s)",field:"test_result",sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"testchange",label:"Change",field:"test_change",sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"teststdev",label:"Test Stdev",field:"test_stdev",sortable:!0,sort:(a,t)=>parseInt(a,10)-parseInt(t,10)},{name:"teststatus",label:"Test Status",field:"test_status",sortable:!0}],X={rowsPerPage:30};function z(){return c.value.length===0?"":`${c.value.length} Test${c.value.length>1?"s":""} selected of ${Q.value.length}`}return(a,t)=>{const r=et("q-markdown");return P(),S(at,{class:"q-pa-sm dark-page"},{default:s(()=>[e(ot),i("div",dt,[t[2]||(t[2]=i("div",{class:"col text-h6 q-ml-md"},[n(" Alpaca Driver Performance Analysis "),i("div",{class:"text-caption text-grey-6"}," Use these pages to perform tests and analyse the performance of your Benro Polaris. ")],-1)),e(O)]),i("div",ct,[i("div",mt,[e(y,{flat:"",bordered:"",class:"col q-pa-md"},{default:s(()=>[i("div",pt,[i("div",ft,[e(r,{"no-mark":!1},{default:s(()=>t[3]||(t[3]=[n(`
  # Motor Speed Calibration
  The Alpaca Driver maps raw move axis commands to angular rates (°/s). Use this page to calibrate against your device. Ensure the mount can move freely in all directions before testing. Remove cameras and equipment first. Calibration changes are applied immediately upon test approval.
  `,-1)])),_:1,__:[3]})]),i("div",_t,[e(T,{style:{"max-width":"800px"}},{default:s(()=>[e(p,null,{default:s(()=>[e(d,{side:"",top:""},{default:s(()=>[e(Y,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=l=>o.value=l),push:"",rounded:"",glossy:"","toggle-color":"primary",options:[{label:"M1",value:0},{label:"M2",value:1},{label:"M3",value:2}]},null,8,["modelValue"])]),_:1}),e(d,null,{default:s(()=>[e(m,null,{default:s(()=>t[4]||(t[4]=[n("Choosen Motor Axis",-1)])),_:1,__:[4]}),e(m,{caption:""},{default:s(()=>t[5]||(t[5]=[n(" Select the motor axis you'd like to calibrate. ",-1)])),_:1,__:[5]})]),_:1})]),_:1}),A(h).lifecycleevent=="NONE"?(P(),S(p,{key:0},{default:s(()=>[e(d,{top:"",side:""},{default:s(()=>[e(k,{rounded:"",push:"",onClick:L},{default:s(()=>t[6]||(t[6]=[n("Test",-1)])),_:1,__:[6]})]),_:1}),e(d,null,{default:s(()=>[e(m,{caption:""},{default:s(()=>[n(" Initiate selected speed calibration tests for "+x(f.value)+". ",1)]),_:1})]),_:1})]),_:1})):$("",!0),A(h).lifecycleevent=="START"?(P(),S(p,{key:1},{default:s(()=>[e(d,{top:"",side:""},{default:s(()=>[e(k,{rounded:"",push:"",onClick:U},{default:s(()=>t[7]||(t[7]=[n("Stop",-1)])),_:1,__:[7]})]),_:1}),e(d,null,{default:s(()=>[e(m,{caption:""},{default:s(()=>[n(" Stop speed calibration tests for "+x(f.value)+". ",1)]),_:1})]),_:1})]),_:1})):$("",!0),e(p,{"inset-level":0},{default:s(()=>[e(d,{top:"",side:""},{default:s(()=>[e(k,{rounded:"",push:"",onClick:E},{default:s(()=>t[8]||(t[8]=[n("Approve",-1)])),_:1,__:[8]})]),_:1}),e(d,null,{default:s(()=>[e(m,{caption:""},{default:s(()=>t[9]||(t[9]=[n(" Toggle Approval/Rejection of selected test cases to override baseline. ",-1)])),_:1,__:[9]})]),_:1})]),_:1})]),_:1})])])]),_:1})]),i("div",vt,[e(y,{flat:"",bordered:"",class:"col"},{default:s(()=>[i("div",bt,[e(st,{title:"Speed Calibration Test Results",dense:"","selected-rows-label":z,pagination:X,selection:"multiple",selected:c.value,"onUpdate:selected":t[1]||(t[1]=l=>c.value=l),rows:Q.value,columns:K,"row-key":"name"},null,8,["selected","rows"])])]),_:1})]),i("div",gt,[e(y,{flat:"",bordered:"",class:"col"},{default:s(()=>[e(T,{style:{"max-width":"800px"}},{default:s(()=>[e(p,null,{default:s(()=>[e(d,null,{default:s(()=>[e(m,null,{default:s(()=>[n(" Angular Position for "+x(f.value),1)]),_:1}),e(m,{caption:""},{default:s(()=>t[10]||(t[10]=[n("M1-3: Measured Position, PV: Present Value Position ",-1)])),_:1,__:[10]})]),_:1})]),_:1})]),_:1}),e(M,{data:D.value,x1Type:"time"},null,8,["data"]),t[11]||(t[11]=i("div",{class:"q-pb-xl"},null,-1))]),_:1,__:[11]})]),i("div",xt,[e(y,{flat:"",bordered:"",class:"col"},{default:s(()=>[e(T,null,{default:s(()=>[e(p,null,{default:s(()=>[e(d,null,{default:s(()=>[e(m,null,{default:s(()=>[n(" Angular Velocity for "+x(f.value),1)]),_:1}),e(m,{caption:""},{default:s(()=>t[12]||(t[12]=[n("M1-3: Measured Velocity, PV: Present Value Velocity. SP: Setpoint Velocity",-1)])),_:1,__:[12]})]),_:1})]),_:1})]),_:1}),e(M,{data:I.value,x1Type:"time"},null,8,["data"])]),_:1})])])]),_:1})}}});export{oe as default};
