import{ai as ue,az as ie,e as le,i as re,a as M,c as i,w as A,aa as ce,aK as fe,h as R,f as de,X as ve,m as me,ab as ge}from"./index-T-4rhSG0.js";import{v as he,e as H,u as ye,l as ke,b as Pe,h as Te,i as Ce,c as xe,p as L,j as we,k as Q,a as Se,r as be,m as Ee,s as Oe}from"./position-engine-DWKJInj3.js";import{u as qe,a as Be,b as Fe}from"./use-model-toggle-CahUEy8D.js";import{u as De,a as Ke}from"./use-dark-DE-NN0Ly.js";import{u as Me,a as Ae}from"./focus-manager-DRvvFMAt.js";import{u as Re}from"./use-timeout-Camtw4_Z.js";import{s as He,a as Le}from"./scroll-DXdCiYO0.js";const a=[];let l;function Qe(e){l=e.keyCode===27}function We(){l===!0&&(l=!1)}function je(e){l===!0&&(l=!1,ie(e,27)===!0&&a[a.length-1](e))}function j(e){window[e]("keydown",Qe),window[e]("blur",We),window[e]("keyup",je),l=!1}function _e(e){ue.is.desktop===!0&&(a.push(e),a.length===1&&j("addEventListener"))}function W(e){const d=a.indexOf(e);d!==-1&&(a.splice(d,1),a.length===0&&j("removeEventListener"))}const Je=le({name:"QMenu",inheritAttrs:!1,props:{...ke,...Be,...De,...ye,persistent:Boolean,autoClose:Boolean,separateClosePopup:Boolean,noEscDismiss:Boolean,noRouteDismiss:Boolean,noRefocus:Boolean,noFocus:Boolean,fit:Boolean,cover:Boolean,square:Boolean,anchor:{type:String,validator:H},self:{type:String,validator:H},offset:{type:Array,validator:he},scrollTarget:He,touchPosition:Boolean,maxHeight:{type:String,default:null},maxWidth:{type:String,default:null}},emits:[...qe,"click","escapeKey"],setup(e,{slots:d,emit:v,attrs:g}){let s=null,m,r,h;const x=re(),{proxy:y}=x,{$q:o}=y,n=M(null),u=M(!1),_=i(()=>e.persistent!==!0&&e.noRouteDismiss!==!0),z=Ke(e,o),{registerTick:I,removeTick:U}=Me(),{registerTimeout:w}=Re(),{transitionProps:X,transitionStyle:$}=Pe(e),{localScrollTarget:S,changeScrollEvent:p,unconfigureScrollTarget:G}=Te(e,D),{anchorEl:c,canShow:J}=Ce({showing:u}),{hide:b}=Fe({showing:u,canShow:J,handleShow:ee,handleHide:te,hideOnRouteChange:_,processOnMount:!0}),{showPortal:E,hidePortal:O,renderPortal:N}=xe(x,n,ne,"menu"),k={anchorEl:c,innerRef:n,onClickOutside(t){if(e.persistent!==!0&&u.value===!0)return b(t),(t.type==="touchstart"||t.target.classList.contains("q-dialog__backdrop"))&&ge(t),!0}},q=i(()=>L(e.anchor||(e.cover===!0?"center middle":"bottom start"),o.lang.rtl)),V=i(()=>e.cover===!0?q.value:L(e.self||"top start",o.lang.rtl)),Y=i(()=>(e.square===!0?" q-menu--square":"")+(z.value===!0?" q-menu--dark q-dark":"")),Z=i(()=>e.autoClose===!0?{onClick:oe}:{}),B=i(()=>u.value===!0&&e.persistent!==!0);A(B,t=>{t===!0?(_e(T),we(k)):(W(T),Q(k))});function P(){Ae(()=>{let t=n.value;t&&t.contains(document.activeElement)!==!0&&(t=t.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||t.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||t.querySelector("[autofocus], [data-autofocus]")||t,t.focus({preventScroll:!0}))})}function ee(t){if(s=e.noRefocus===!1?document.activeElement:null,Se(K),E(),D(),m=void 0,t!==void 0&&(e.touchPosition||e.contextMenu)){const C=ce(t);if(C.left!==void 0){const{top:ae,left:se}=c.value.getBoundingClientRect();m={left:C.left-se,top:C.top-ae}}}r===void 0&&(r=A(()=>o.screen.width+"|"+o.screen.height+"|"+e.self+"|"+e.anchor+"|"+o.lang.rtl,f)),e.noFocus!==!0&&document.activeElement.blur(),I(()=>{f(),e.noFocus!==!0&&P()}),w(()=>{o.platform.is.ios===!0&&(h=e.autoClose,n.value.click()),f(),E(!0),v("show",t)},e.transitionDuration)}function te(t){U(),O(),F(!0),s!==null&&(t===void 0||t.qClickOutside!==!0)&&(((t?.type.indexOf("key")===0?s.closest('[tabindex]:not([tabindex^="-"])'):void 0)||s).focus(),s=null),w(()=>{O(!0),v("hide",t)},e.transitionDuration)}function F(t){m=void 0,r!==void 0&&(r(),r=void 0),(t===!0||u.value===!0)&&(be(K),G(),Q(k),W(T)),t!==!0&&(s=null)}function D(){(c.value!==null||e.scrollTarget!==void 0)&&(S.value=Le(c.value,e.scrollTarget),p(S.value,f))}function oe(t){h!==!0?(Ee(y,t),v("click",t)):h=!1}function K(t){B.value===!0&&e.noFocus!==!0&&fe(n.value,t.target)!==!0&&P()}function T(t){e.noEscDismiss!==!0&&(v("escapeKey"),b(t))}function f(){Oe({targetEl:n.value,offset:e.offset,anchorEl:c.value,anchorOrigin:q.value,selfOrigin:V.value,absoluteOffset:m,fit:e.fit,cover:e.cover,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function ne(){return R(ve,X.value,()=>u.value===!0?R("div",{role:"menu",...g,ref:n,tabindex:-1,class:["q-menu q-position-engine scroll"+Y.value,g.class],style:[g.style,$.value],...Z.value},de(d.default)):null)}return me(F),Object.assign(y,{focus:P,updatePosition:f}),N}});export{Je as Q,_e as a,W as r};
