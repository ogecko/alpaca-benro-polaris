import{Q as k}from"./QTooltip-C-Ptux3l.js";import{a1 as Y,aw as Z,d as ee,a as E,c as f,q as te,D as ae,E as b,F as l,H as m,I as n,J as P,K as L,Q as w,N as p,M as r,s as C,R as oe,P as le,O as D,T as ne,S as ie}from"./index-CYMS3cRB.js";import{Q as se}from"./QBtnGroup-D0GC2VMe.js";import{Q as z}from"./QItemLabel-CR4NKeRl.js";import{Q as S,a as I}from"./QItem-PkKJGLwX.js";import{Q as re}from"./QList-4KZyepCx.js";import{Q as ce}from"./QBtnDropdown-DXwg5OoT.js";import{Q as de}from"./QSpace-61SGXAn0.js";import{Q as ue}from"./QChip-nl2mDiX7.js";import{Q as pe}from"./QPage-ZRV8Lbsr.js";import{g as me,d as fe}from"./position-engine-B_7cvKln.js";import{u as ge}from"./use-quasar-CySHHT5q.js";import{u as ve}from"./device-B-M9G2lS.js";import{u as ke}from"./status-BPsIp4sw.js";import{a as Q,S as be}from"./SpinnerSpeed-qkSqLrfv.js";import{_ as _e}from"./StatusBanners.vue_vue_type_script_setup_true_lang-BKMw9_DW.js";import{e as _}from"./angles-CM-dTGcw.js";import"./use-model-toggle-Dd0TX-To.js";import"./focus-manager-CQtTx6D0.js";import"./use-timeout-CvGNwR6b.js";import"./selection-Ca_2EiFv.js";import"./use-dark-BB_R-jdB.js";import"./QMenu-8uTSvFWo.js";import"./use-key-composition-DHCk1ZlV.js";import"./QInput-DMPrcKzf.js";import"./index-DaEgsOZv.js";import"./scale-BUHoRS_z.js";import"./MoveButton.vue_vue_type_script_setup_true_lang-DnQ7RVIr.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QBanner-COuVYuIS.js";function N(s){if(s===!1)return 0;if(s===!0||s===void 0)return 1;const c=parseInt(s,10);return isNaN(c)?0:c}const R=Y({name:"close-popup",beforeMount(s,{value:c}){const d={depth:N(c),handler(o){d.depth!==0&&setTimeout(()=>{const e=me(s);e!==void 0&&fe(e,o,d.depth)})},handlerKey(o){Z(o,13)===!0&&d.handler(o)}};s.__qclosepopup=d,s.addEventListener("click",d.handler),s.addEventListener("keyup",d.handlerKey)},updated(s,{value:c,oldValue:d}){c!==d&&(s.__qclosepopup.depth=N(c))},beforeUnmount(s){const c=s.__qclosepopup;s.removeEventListener("click",c.handler),s.removeEventListener("keyup",c.handlerKey),delete s.__qclosepopup}}),we={class:"row q-pa-xs items-center q-col-gutter-sm"},ye={class:"q-pb-sm"},he={class:"q-gutter-md"},Ae={class:"row"},Pe={key:0,class:"col-12 col-md-6 col-lg-4 col-xl-3 row justify-center"},at=ee({__name:"DashboardPage",setup(s){const c=ge(),d=ae(),o=ve(),e=ke(),y=E(!1),$=E(!0),H=f(()=>y.value?[{label:"Right Ascension",pv:e.rightascension,sp:e.deltarefRAhrs,domain:"ra_24"},{label:"Declination",pv:e.declination,sp:e.deltaref[1],domain:"dec_180"},{label:"Position Angle",pv:e.positionangle,sp:e.deltaref[2],domain:"pa_360"}]:[{label:"Azimuth",pv:e.azimuth,sp:e.alpharef[0],domain:"az_360"},{label:"Altitude",pv:e.altitude,sp:e.alpharef[1],domain:"alt_90"},{label:"Roll",pv:e.roll,sp:e.alpharef[2],domain:"roll_180"}]),G=f(()=>{if(e.pidmode!="IDLE")return!1;const t=_(e.rightascension,e.deltarefRAhrs),a=_(e.declination,e.deltaref[1]??0),i=_(e.positionangle,e.deltaref[2]??0),u=_(e.azimuth,e.alpharef[0]??0),q=_(e.altitude,e.alpharef[1]??0),x=_(e.roll,e.alpharef[2]??0);return t*t+a*a+i*i+u*u+q*q+x*x>1}),g=f(()=>(c.screen.lt.sm,"md")),v=f(()=>!!c.screen.lt.md),T=f(()=>e.pidmode=="PRESETUP"?"PreSetup":e.pidmode=="LIMIT"?"Limit":e.pidmode=="HOMING"?"Homing":e.pidmode=="PARKING"?"Parking":e.atpark?"Parked":e.gotoing?"Gotoing":e.slewing?"Slewing":e.rotating?"Rotating":e.ispulseguiding?"Guiding":e.tracking?"Tracking":"Idle"),K=f(()=>e.pidmode=="PRESETUP"||e.pidmode=="LIMIT"?"negative":"positive"),B=f(()=>e.pidmode=="PRESETUP"?"mdi-cellphone-cog":e.pidmode=="LIMIT"?"mdi-alert":e.pidmode=="HOMING"?"mdi-home-outline":e.pidmode=="PARKING"?"mdi-alpha-p":e.atpark?"mdi-parking":e.gotoing?"mdi-move-resize-variant":e.slewing?"mdi-cursor-move":e.rotating?"mdi-restore":e.ispulseguiding?"mdi-pulse":e.tracking?"mdi-star-shooting-outline":"mdi-sleep");te(async()=>{const t=Array.isArray(d.query.api)?d.query.api[0]:d.query.api;t&&(o.restAPIPort=parseInt(t)),!o.alpacaHost&&window.location.hostname&&(o.alpacaHost=window.location.hostname),!o.restAPIPort&&window.location.port&&(o.restAPIPort=parseInt(window.location.port)),o.alpacaHost&&o.restAPIPort&&await o.connectRestAPI()});function h(t){return e.atpark?(c.notify({message:`Cannot ${t} while mount is parked.`,type:"negative",position:"top",timeout:3e3,actions:[{icon:"mdi-close",color:"white"}]}),!0):!1}async function O(){const t=await o.alpacaResetSP();console.log(t)}async function F(){if(h("toggle tracking"))return;const t=e.tracking?await o.alpacaTracking(!1):await o.alpacaTracking(!0);console.log(t)}async function A(t){const a=await o.alpacaTrackingRate(t);console.log(a)}async function U(){const t=await o.alpacaFindHome();console.log(t)}async function V(){const t=e.atpark?await o.alpacaUnPark():await o.alpacaPark();console.log(t)}async function j(){if(h("abort"))return;$.value=!1,setTimeout(()=>{$.value=!0},200);const t=await o.alpacaAbortSlew();console.log(t)}async function J(t){if(!h("slew"))if(t.label=="Azimuth"){const a=t.angle,i=e.alpharef[1]??0,u=await o.alpacaSlewToAltAz(i,a);console.log(`Change ${t.label} angle to ${t.angle}`,u)}else if(t.label=="Altitude"){const a=e.alpharef[0]??0,i=t.angle,u=await o.alpacaSlewToAltAz(i,a);console.log(`Change ${t.label} angle to ${t.angle}`,u)}else if(t.label=="Roll"){const a=await o.alpacaMoveMechanical(t.angle);console.log(`Change ${t.label} angle to ${t.angle}`,a)}else if(t.label=="Right Ascension"){const a=t.angle,i=e.deltaref[1]??0,u=await o.alpacaSlewToCoord(a,i);console.log(`Change ${t.label} angle to ${t.angle}`,u)}else if(t.label=="Declination"){const a=e.deltarefRAhrs??0,i=t.angle,u=await o.alpacaSlewToCoord(a,i);console.log(`Change ${t.label} angle to ${t.angle}`,u)}else if(t.label=="Position Angle"){const a=await o.alpacaMoveAbsolute(t.angle);console.log(`Change ${t.label} angle to ${t.angle}`,a)}else console.log(`Click ${t.label} angle: ${t.angle}, offset: ${t.radialOffset}`)}async function W(t){if(h("slew"))return;const a=t.az??e.alpharef[0]??0,i=t.alt??e.alpharef[1]??0;t.roll!==void 0&&await o.alpacaMoveMechanical(t.roll),(t.az!==void 0||t.alt!==void 0)&&await o.alpacaSlewToAltAz(i,a),console.log("Fab Angle:",t)}const M={Azimuth:0,Altitude:1,Roll:2,"Right Ascension":3,Declination:4,"Position Angle":5};async function X(t){if(console.log("ClickMove ",t.label,t.rateScale),!Object.keys(M).includes(t.label))return;const a=M[t.label]??-1,i=a!=3?t.rateScale/200*9:t.rateScale/12*9;a>=0&&a<=5&&await o.apiAction("Polaris:MoveAxis",`{"axis":${a},"rate":${i}}`)}return(t,a)=>(m(),b(pe,{class:"q-pa-sm"},{default:l(()=>[n(_e),P("div",we,[P("div",ye,[P("div",he,[n(se,null,{default:l(()=>[n(w,{icon:"mdi-telescope",glossy:"",dense:v.value,size:g.value,color:"secondary",push:"",outline:!y.value,onClick:a[0]||(a[0]=i=>y.value=!y.value)},{default:l(()=>[n(k,null,{default:l(()=>a[5]||(a[5]=[p("Switch between Equatorial and Az/Alt Co-ordinates.",-1)])),_:1,__:[5]})]),_:1},8,["dense","size","outline"]),G.value?(m(),b(w,{key:0,icon:"mdi-format-horizontal-align-center",glossy:"",dense:v.value,size:g.value,color:"secondary",outline:"",onClick:O},{default:l(()=>[n(k,null,{default:l(()=>a[6]||(a[6]=[p("Reset all setpoints to their current values.",-1)])),_:1,__:[6]})]),_:1},8,["dense","size"])):L("",!0),n(w,{icon:"mdi-home",glossy:"",dense:v.value,size:g.value,color:"secondary",outline:r(e).pidmode!="HOMING",onClick:U},{default:l(()=>[n(k,null,{default:l(()=>a[7]||(a[7]=[p("Return the mount to its Home position",-1)])),_:1,__:[7]})]),_:1},8,["dense","size","outline"]),n(w,{icon:"mdi-parking",glossy:"",dense:v.value,size:g.value,color:"secondary",outline:r(e).pidmode!="PARKING",onClick:V},{default:l(()=>[n(k,null,{default:l(()=>a[8]||(a[8]=[p("Return the mount to its Park position.",-1)])),_:1,__:[8]})]),_:1},8,["dense","size","outline"]),n(w,{icon:"mdi-stop",glossy:"",dense:v.value,size:g.value,color:"secondary",outline:$.value,onClick:j},{default:l(()=>[n(k,null,{default:l(()=>a[9]||(a[9]=[p("Stop all motion of the mount.",-1)])),_:1,__:[9]})]),_:1},8,["dense","size","outline"])]),_:1}),n(ce,{dense:v.value,glossy:"",size:g.value,color:"secondary",split:"",outline:!r(e).tracking,onClick:F},{label:l(()=>[n(oe,{name:"mdi-star-shooting-outline"}),n(k,null,{default:l(()=>a[10]||(a[10]=[p("Toggle tracking on and off.",-1)])),_:1,__:[10]})]),default:l(()=>[n(re,{dense:""},{default:l(()=>[C((m(),b(S,{clickable:"",active:r(e).trackingrate==0,"active-class":"bg-secondary text-white",onClick:a[1]||(a[1]=i=>A(0))},{default:l(()=>[n(I,null,{default:l(()=>[n(z,null,{default:l(()=>a[11]||(a[11]=[p("Sidereal",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),b(S,{clickable:"",active:r(e).trackingrate==1,"active-class":"bg-secondary text-white",onClick:a[2]||(a[2]=i=>A(1))},{default:l(()=>[n(I,null,{default:l(()=>[n(z,null,{default:l(()=>a[12]||(a[12]=[p("Lunar",-1)])),_:1,__:[12]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),b(S,{clickable:"",active:r(e).trackingrate==2,"active-class":"bg-secondary text-white",onClick:a[3]||(a[3]=i=>A(2))},{default:l(()=>[n(I,null,{default:l(()=>[n(z,null,{default:l(()=>a[13]||(a[13]=[p("Solar",-1)])),_:1,__:[13]})]),_:1})]),_:1},8,["active"])),[[R]]),C((m(),b(S,{clickable:"",active:r(e).trackingrate==3,"active-class":"bg-secondary text-white",onClick:a[4]||(a[4]=i=>A(3))},{default:l(()=>[n(I,null,{default:l(()=>[n(z,null,{default:l(()=>a[14]||(a[14]=[p("Custom",-1)])),_:1,__:[14]})]),_:1})]),_:1},8,["active"])),[[R]])]),_:1})]),_:1},8,["dense","size","outline"])])]),n(de),n(ue,{color:K.value,outline:T.value=="Idle",icon:B.value,class:"q-pa-md"},{default:l(()=>[p(le(T.value),1)]),_:1},8,["color","outline","icon"])]),P("div",Ae,[(m(!0),D(ie,null,ne(H.value,(i,u)=>(m(),D("div",{key:u,class:"col-12 col-md-6 col-lg-4 col-xl-3"},[n(be,{label:i.label,pv:i.pv,sp:i.sp,lst:r(e).siderealtime,domain:i.domain,onClickScale:J,onClickFabAngle:W,onClickMove:X},null,8,["label","pv","sp","lst","domain"])]))),128)),r(e).pidmode!="PARK"?(m(),D("div",Pe,[n(Q,{class:"q-pa-sm",speed:r(e).motorref[0],position:r(e).zetameas[0],label:"M1"},null,8,["speed","position"]),n(Q,{class:"q-pa-sm",speed:r(e).motorref[1],position:r(e).zetameas[1],label:"M2"},null,8,["speed","position"]),n(Q,{class:"q-pa-sm",speed:r(e).motorref[2],position:r(e).zetameas[2],label:"M3"},null,8,["speed","position"])])):L("",!0)])]),_:1}))}});export{at as default};
